<!DOCTYPE html><html><head><link rel="shortcut icon" href="/favicon.ico?"/><link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><script>window.__REACT_DEVTOOLS_GLOBAL_HOOK__.inject
                                =function(){}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DGNKE718G"></script><script>
                                    window.dataLayer = window.dataLayer || [];
                                    function gtag(){dataLayer.push(arguments);}
                                    gtag('js', new Date());
                                    gtag('config', 'G-3DGNKE718G');
                                    </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="记录工作学习兴趣爱好笔记"/><meta property="og:description" content="记录工作学习兴趣爱好笔记"/><meta http-equiv="x-ua-compatible" content="IE=edge; chrome=1"/><meta name="application-name" content="gwl002&#x27;s blog"/><title>暮天云光-react-native下载pdf文件</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta property="og:title" content="暮天云光-react-native下载pdf文件"/><meta name="keywords" content=""/><meta name="next-head-count" content="11"/><link rel="preload" href="/_next/static/css/cc26ab9dcbf540c5d6ed.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cc26ab9dcbf540c5d6ed.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c1210a331268eed04652.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c1210a331268eed04652.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-a905968bdef42c973edb.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-593aa47955db315fed75.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-d5cc49017566d8f84508.js" as="script"/><link rel="preload" href="/_next/static/chunks/252-594c4aef779f4680464f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/article/%5Bid%5D-d59325b5a90cee2c7259.js" as="script"/></head><body><div id="__next"><nav class="navbar_navbar__1EgTS"><div class="navbar_containerFluid__3lQQx"><a class="navbar_navbarHeader__25-ag" href="/">暮天云光</a><ul class="navbar_nav__6ovd1"><li><a href="/">HOME</a></li><li><a href="/about">关于</a></li><li><a href="/game">小游戏</a></li><li><a href="/archives">归档</a></li><li><a href="/tag">标签</a></li></ul><button class="navbar_navToggle__1WISG" id="nav-toggle"><span class="navbar_iconBar__10AK6"></span><span class="navbar_iconBar__10AK6 navbar_mid__E-C7Y"></span><span class="navbar_iconBar__10AK6"></span></button></div></nav><header class="header_header__2q1wF"><div class="container"><div class="column"><div class="content"><div class="header_articleHeading__CG-Mk"><div class="header_tags__1EkWf"><a href="/tag#react-native">react-native</a></div><h1>react-native下载pdf文件</h1><span class="header_meta__pX6i-">Posted by gwl002 on <!-- -->2021-06-22</span></div></div></div></div></header><article><div class="container"><div class="column"><div class="content"><div class="article_article__15ETi"><p>很久就实现过的功能，今天又遇到了，竟然无从下手，只好去翻翻旧代码并在这里记录一下也方便日后查看。</p>
<h1>需求分析</h1>
<ul>
<li>ajax请求pdf文件</li>
<li>转成base64</li>
<li>下载到手机，需要能从外部App打开</li>
</ul>
<h3>1. 首先获取pdf文件二进制</h3>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">async</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">function</span><span> </span><span class="token token" style="color:#c792ea">getPdfBinary</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">url</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">Promise</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">resolve</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> reject</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> xhr </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">XMLHttpRequest</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        xhr</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">open</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;GET&quot;</span><span class="token token" style="color:#89ddff">,</span><span> url</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">true</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        xhr</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">responseType</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&quot;arraybuffer&quot;</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">// get the binary </span><span>
</span><span>        xhr</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">setRequestHeader</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;content-type&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;application/json&#x27;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        xhr</span><span class="token token" style="color:#89ddff">.</span><span class="token token method-variable function-variable method property-access" style="color:#c792ea">onload</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">function</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">event</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>            </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> arrayBuffer </span><span class="token token" style="color:#89ddff">=</span><span> xhr</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">response</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> byteArray </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">Uint8Array</span><span class="token token" style="color:#89ddff">(</span><span>arrayBuffer</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> len </span><span class="token token" style="color:#89ddff">=</span><span> byteArray</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">byteLength</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> binary </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&quot;&quot;</span><span>
</span><span>            </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">for</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> i </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">;</span><span> i </span><span class="token token" style="color:#89ddff">&lt;</span><span> len</span><span class="token token" style="color:#89ddff">;</span><span> i</span><span class="token token" style="color:#89ddff">++</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                binary </span><span class="token token" style="color:#89ddff">+=</span><span> </span><span class="token token known-class-name" style="color:#f2ff00">String</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">fromCharCode</span><span class="token token" style="color:#89ddff">(</span><span>byteArray</span><span class="token token" style="color:#89ddff">[</span><span>i</span><span class="token token" style="color:#89ddff">]</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>            </span><span class="token token" style="color:#c792ea">resolve</span><span class="token token" style="color:#89ddff">(</span><span>binary</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>        xhr</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">send</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span>
</span></code></div></pre>
<h3>2. 转成base64字符串</h3>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#546e7a">//react-native 并没有btoa和atob方法 需要自己实现</span><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">function</span><span> </span><span class="token token" style="color:#c792ea">base64_encode</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">str</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> c1</span><span class="token token" style="color:#89ddff">,</span><span> c2</span><span class="token token" style="color:#89ddff">,</span><span> c3</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> base64EncodeChars </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> i </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        len </span><span class="token token" style="color:#89ddff">=</span><span> str</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">length</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        string </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;&#x27;</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">while</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>i </span><span class="token token" style="color:#89ddff">&lt;</span><span> len</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        c1 </span><span class="token token" style="color:#89ddff">=</span><span> str</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charCodeAt</span><span class="token token" style="color:#89ddff">(</span><span>i</span><span class="token token" style="color:#89ddff">++</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0xff</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>i </span><span class="token token" style="color:#89ddff">==</span><span> len</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>            string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span>c1 </span><span class="token token" style="color:#89ddff">&gt;&gt;</span><span> </span><span class="token token" style="color:#fd9170">2</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span>c1 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0x3</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&lt;&lt;</span><span> </span><span class="token token" style="color:#fd9170">4</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            string </span><span class="token token" style="color:#89ddff">+=</span><span> </span><span class="token token" style="color:#c3e88d">&quot;==&quot;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">break</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>        c2 </span><span class="token token" style="color:#89ddff">=</span><span> str</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charCodeAt</span><span class="token token" style="color:#89ddff">(</span><span>i</span><span class="token token" style="color:#89ddff">++</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>i </span><span class="token token" style="color:#89ddff">==</span><span> len</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>            string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span>c1 </span><span class="token token" style="color:#89ddff">&gt;&gt;</span><span> </span><span class="token token" style="color:#fd9170">2</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span>c1 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0x3</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&lt;&lt;</span><span> </span><span class="token token" style="color:#fd9170">4</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">|</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span>c2 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0xF0</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&gt;&gt;</span><span> </span><span class="token token" style="color:#fd9170">4</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span>c2 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0xF</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&lt;&lt;</span><span> </span><span class="token token" style="color:#fd9170">2</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            string </span><span class="token token" style="color:#89ddff">+=</span><span> </span><span class="token token" style="color:#c3e88d">&quot;=&quot;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">break</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>        c3 </span><span class="token token" style="color:#89ddff">=</span><span> str</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charCodeAt</span><span class="token token" style="color:#89ddff">(</span><span>i</span><span class="token token" style="color:#89ddff">++</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span>c1 </span><span class="token token" style="color:#89ddff">&gt;&gt;</span><span> </span><span class="token token" style="color:#fd9170">2</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span>c1 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0x3</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&lt;&lt;</span><span> </span><span class="token token" style="color:#fd9170">4</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">|</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span>c2 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0xF0</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&gt;&gt;</span><span> </span><span class="token token" style="color:#fd9170">4</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span>c2 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0xF</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&lt;&lt;</span><span> </span><span class="token token" style="color:#fd9170">2</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">|</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span>c3 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0xC0</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">&gt;&gt;</span><span> </span><span class="token token" style="color:#fd9170">6</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        string </span><span class="token token" style="color:#89ddff">+=</span><span> base64EncodeChars</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">charAt</span><span class="token token" style="color:#89ddff">(</span><span>c3 </span><span class="token token" style="color:#89ddff">&amp;</span><span> </span><span class="token token" style="color:#fd9170">0x3F</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> string
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<h3>3. 下载到android手机</h3>
<p>今天刚好在stackoverflow上回答别人的问题，他需要的是expo，所以写了个expo版本的。<a href="https://stackoverflow.com/questions/68076316/base64-string-to-pdf-javascript-react-native-then-download/68076982#68076982">Base64 String to pdf JavaScript React Native then download</a>
For expo</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">downloadForAos</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">async</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">pdfBase64Str</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> folder </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token maybe-class-name">FileSystem</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access maybe-class-name">StorageAccessFramework</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">getUriForDirectoryInRoot</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;test&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> permissions </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token maybe-class-name">FileSystem</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access maybe-class-name">StorageAccessFramework</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">requestDirectoryPermissionsAsync</span><span class="token token" style="color:#89ddff">(</span><span>folder</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">!</span><span>permissions</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">granted</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>    </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> filePath </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token maybe-class-name">FileSystem</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access maybe-class-name">StorageAccessFramework</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">createFileAsync</span><span class="token token" style="color:#89ddff">(</span><span>permissions</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">directoryUri</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;test.pdf&quot;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;application/pdf&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#546e7a">// let filePath = &quot;content://com.android.externalstorage.documents/tree/primary%3Atest/document/primary%3Atest%2Ftest.txt&quot;;</span><span>
</span><span>    </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">log</span><span class="token token" style="color:#89ddff">(</span><span>pdfBase64Str</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;====&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">try</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token maybe-class-name">FileSystem</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access maybe-class-name">StorageAccessFramework</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">writeAsStringAsync</span><span class="token token" style="color:#89ddff">(</span><span>filePath</span><span class="token token" style="color:#89ddff">,</span><span> pdfBase64Str</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#89ddff">{</span><span> </span><span class="token token literal-property" style="color:#80cbc4">encoding</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token maybe-class-name">FileSystem</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access maybe-class-name">EncodingType</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access maybe-class-name">Base64</span><span> </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea">alert</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;download success!&quot;</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">catch</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>err</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">log</span><span class="token token" style="color:#89ddff">(</span><span>err</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<p>For android</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">downloadForAos</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">async</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">pdfBase64Str</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> fileName </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token template-string template-punctuation" style="color:#c3e88d">`</span><span class="token token template-string" style="color:#c3e88d">/</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#89ddff">${</span><span class="token token template-string interpolation known-class-name" style="color:#f2ff00">Date</span><span class="token token template-string interpolation" style="color:#89ddff">.</span><span class="token token template-string interpolation method property-access" style="color:#c792ea">now</span><span class="token token template-string interpolation" style="color:#89ddff">(</span><span class="token token template-string interpolation" style="color:#89ddff">)</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#89ddff">}</span><span class="token token template-string" style="color:#c3e88d">_report.pdf</span><span class="token token template-string template-punctuation" style="color:#c3e88d">`</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> path </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">RNFS</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access maybe-class-name">DownloadDirectoryPath</span><span> </span><span class="token token" style="color:#89ddff">+</span><span> fileName</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">try</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> granted </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token maybe-class-name">PermissionsAndroid</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">request</span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>            </span><span class="token token maybe-class-name">PermissionsAndroid</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#c792ea">PERMISSIONS</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#c792ea">WRITE_EXTERNAL_STORAGE</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>granted</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>            </span><span class="token token" style="color:#c792ea">RNFS</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">writeFile</span><span class="token token" style="color:#89ddff">(</span><span>path</span><span class="token token" style="color:#89ddff">,</span><span> pdfBase64Str</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;base64&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">then</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">res</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                </span><span class="token token maybe-class-name">ToastAndroid</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">show</span><span class="token token" style="color:#89ddff">(</span><span class="token token maybe-class-name">I18n</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">t</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;myHealth.Downloaded&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token maybe-class-name">ToastAndroid</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#c792ea">SHORT</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token control-flow" style="color:#c792ea;font-style:italic">catch</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">error</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                </span><span class="token token maybe-class-name">ToastAndroid</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">show</span><span class="token token" style="color:#89ddff">(</span><span class="token token maybe-class-name">I18n</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">t</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;myHealth.DownloadFailed&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token maybe-class-name">ToastAndroid</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#c792ea">SHORT</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">catch</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>err</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">warn</span><span class="token token" style="color:#89ddff">(</span><span>err</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<h3>4. 下载到ios手机</h3>
<p>ios不能直接下载文件到外部app，只能通过分享到file app实现。找了很久没找到其他办法，有其他办法的大神请多多指教。</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">downloadPdfForIos</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">async</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">pdf</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> url </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&quot;data:application/pdf;base64,&quot;</span><span> </span><span class="token token" style="color:#89ddff">+</span><span> pdf</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> shareOptions </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token literal-property" style="color:#80cbc4">title</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;image report&#x27;</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        </span><span class="token token literal-property" style="color:#80cbc4">failOnCancel</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c792ea">false</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        </span><span class="token token literal-property" style="color:#80cbc4">saveToFiles</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c792ea">true</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        </span><span class="token token literal-property" style="color:#80cbc4">url</span><span class="token token" style="color:#89ddff">:</span><span> url</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#546e7a">// base64 with mimeType or path to local file</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">try</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token maybe-class-name">ShareResponse</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token maybe-class-name">Share</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">open</span><span class="token token" style="color:#89ddff">(</span><span>shareOptions</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token maybe-class-name">Alert</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">alert</span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>            </span><span class="token token null nil" style="color:#c792ea;font-style:italic">null</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>            </span><span class="token token maybe-class-name">I18n</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">t</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;myHealth.Downloaded&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">[</span><span>
</span><span>                </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                    </span><span class="token token literal-property" style="color:#80cbc4">text</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token maybe-class-name">I18n</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">t</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;common.OK&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                    </span><span class="token token function-variable" style="color:#c792ea">onPress</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token null nil" style="color:#c792ea;font-style:italic">null</span><span>
</span><span>                </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">]</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">catch</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>error</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>error</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">error</span><span> </span><span class="token token" style="color:#89ddff">&amp;&amp;</span><span> error</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">error</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">code</span><span> </span><span class="token token" style="color:#89ddff">===</span><span> </span><span class="token token" style="color:#c3e88d">&quot;ECANCELLED500&quot;</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>            </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">warn</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;canceled&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">else</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>            </span><span class="token token maybe-class-name">Alert</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">alert</span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>                </span><span class="token token null nil" style="color:#c792ea;font-style:italic">null</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                </span><span class="token token maybe-class-name">I18n</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">t</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;myHealth.DownloadFailed&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                </span><span class="token token" style="color:#89ddff">[</span><span>
</span><span>                    </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                        </span><span class="token token literal-property" style="color:#80cbc4">text</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token maybe-class-name">I18n</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">t</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;common.OK&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                        </span><span class="token token function-variable" style="color:#c792ea">onPress</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token null nil" style="color:#c792ea;font-style:italic">null</span><span>
</span><span>                    </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>                </span><span class="token token" style="color:#89ddff">]</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span>
</span></code></div></pre><hr/></div><strong class="article_remark__Gs6Yc"><a href="https://github.com/gwl002/gwl002.github.io/issues/6">在github上参与本文讨论</a></strong><div class="home_sidebar__31WDI"><section><h5><a href="/tags">FEATURED TAGS</a></h5><ul><li class="home_tag__bnOVo"><a href="/tag#react-native">react-native</a></li></ul></section></div></div></div></div></article><footer class="footer_footer__1cByA"><div class="footer_copywriting__2a9K7"><p>Copyright © 暮天云光 <!-- -->2022</p><p><span>Posted by  <a href="https://github.com/gwl002" target="_blank" rel="noopener noreferrer">gwl002</a></span><span> | 订阅本站<iframe style="margin-left:2px;margin-bottom:-5px" frameBorder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=gwl002&amp;repo=gwl002.github.io&amp;type=star&amp;count=false"></iframe></span></p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"4c3e4ca0899dd22eeb674d05e4811887","title":"react-native下载pdf文件","body":"很久就实现过的功能，今天又遇到了，竟然无从下手，只好去翻翻旧代码并在这里记录一下也方便日后查看。\r\n\r\n# 需求分析\r\n- ajax请求pdf文件\r\n- 转成base64\r\n- 下载到手机，需要能从外部App打开\r\n\r\n### 1. 首先获取pdf文件二进制\r\n```jsx\r\nasync function getPdfBinary(url) {\r\n    return new Promise((resolve, reject) =\u003e {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", url, true);\r\n        xhr.responseType = \"arraybuffer\"; // get the binary \r\n        xhr.setRequestHeader('content-type', 'application/json');\r\n        xhr.onload = function (event) {\r\n            var arrayBuffer = xhr.response;\r\n            var byteArray = new Uint8Array(arrayBuffer);\r\n            var len = byteArray.byteLength;\r\n            var binary = \"\"\r\n            for (var i = 0; i \u003c len; i++) {\r\n                binary += String.fromCharCode(byteArray[i]);\r\n            }\r\n            resolve(binary);\r\n        }\r\n        xhr.send();\r\n    })\r\n}\r\n\r\n```\r\n### 2. 转成base64字符串\r\n```jsx\r\n//react-native 并没有btoa和atob方法 需要自己实现\r\nfunction base64_encode(str) {\r\n    var c1, c2, c3;\r\n    var base64EncodeChars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\n    var i = 0,\r\n        len = str.length,\r\n        string = '';\r\n\r\n    while (i \u003c len) {\r\n        c1 = str.charCodeAt(i++) \u0026 0xff;\r\n        if (i == len) {\r\n            string += base64EncodeChars.charAt(c1 \u003e\u003e 2);\r\n            string += base64EncodeChars.charAt((c1 \u0026 0x3) \u003c\u003c 4);\r\n            string += \"==\";\r\n            break;\r\n        }\r\n        c2 = str.charCodeAt(i++);\r\n        if (i == len) {\r\n            string += base64EncodeChars.charAt(c1 \u003e\u003e 2);\r\n            string += base64EncodeChars.charAt(((c1 \u0026 0x3) \u003c\u003c 4) | ((c2 \u0026 0xF0) \u003e\u003e 4));\r\n            string += base64EncodeChars.charAt((c2 \u0026 0xF) \u003c\u003c 2);\r\n            string += \"=\";\r\n            break;\r\n        }\r\n        c3 = str.charCodeAt(i++);\r\n        string += base64EncodeChars.charAt(c1 \u003e\u003e 2);\r\n        string += base64EncodeChars.charAt(((c1 \u0026 0x3) \u003c\u003c 4) | ((c2 \u0026 0xF0) \u003e\u003e 4));\r\n        string += base64EncodeChars.charAt(((c2 \u0026 0xF) \u003c\u003c 2) | ((c3 \u0026 0xC0) \u003e\u003e 6));\r\n        string += base64EncodeChars.charAt(c3 \u0026 0x3F)\r\n    }\r\n    return string\r\n}\r\n```\r\n### 3. 下载到android手机\r\n今天刚好在stackoverflow上回答别人的问题，他需要的是expo，所以写了个expo版本的。[Base64 String to pdf JavaScript React Native then download](https://stackoverflow.com/questions/68076316/base64-string-to-pdf-javascript-react-native-then-download/68076982#68076982)\r\nFor expo\r\n```jsx\r\nconst downloadForAos = async (pdfBase64Str) =\u003e {\r\n    const folder = FileSystem.StorageAccessFramework.getUriForDirectoryInRoot(\"test\");\r\n    const permissions = await FileSystem.StorageAccessFramework.requestDirectoryPermissionsAsync(folder);\r\n    if (!permissions.granted) return;\r\n\r\n    let filePath = await FileSystem.StorageAccessFramework.createFileAsync(permissions.directoryUri, \"test.pdf\", \"application/pdf\");\r\n    // let filePath = \"content://com.android.externalstorage.documents/tree/primary%3Atest/document/primary%3Atest%2Ftest.txt\";\r\n    console.log(pdfBase64Str, \"====\");\r\n    try {\r\n        await FileSystem.StorageAccessFramework.writeAsStringAsync(filePath, pdfBase64Str, { encoding: FileSystem.EncodingType.Base64 });\r\n        alert(\"download success!\")\r\n    } catch (err) {\r\n        console.log(err);\r\n    }\r\n}\r\n```\r\nFor android\r\n``` jsx\r\nconst downloadForAos = async (pdfBase64Str) =\u003e {\r\n    const fileName = `/${Date.now()}_report.pdf`;\r\n    const path = RNFS.DownloadDirectoryPath + fileName;\r\n    try {\r\n        const granted = await PermissionsAndroid.request(\r\n            PermissionsAndroid.PERMISSIONS.WRITE_EXTERNAL_STORAGE,\r\n        );\r\n        if (granted) {\r\n            RNFS.writeFile(path, pdfBase64Str, \"base64\").then(res =\u003e {\r\n                ToastAndroid.show(I18n.t(\"myHealth.Downloaded\"), ToastAndroid.SHORT);\r\n            }).catch(error =\u003e {\r\n                ToastAndroid.show(I18n.t(\"myHealth.DownloadFailed\"), ToastAndroid.SHORT);\r\n            })\r\n        }\r\n    } catch (err) {\r\n        console.warn(err);\r\n    }\r\n}\r\n```\r\n### 4. 下载到ios手机\r\nios不能直接下载文件到外部app，只能通过分享到file app实现。找了很久没找到其他办法，有其他办法的大神请多多指教。\r\n```jsx\r\nconst downloadPdfForIos = async (pdf) =\u003e {\r\n    const url = \"data:application/pdf;base64,\" + pdf;\r\n    const shareOptions = {\r\n        title: 'image report',\r\n        failOnCancel: false,\r\n        saveToFiles: true,\r\n        url: url, // base64 with mimeType or path to local file\r\n    };\r\n    try {\r\n        const ShareResponse = await Share.open(shareOptions);\r\n        Alert.alert(\r\n            null,\r\n            I18n.t(\"myHealth.Downloaded\"),\r\n            [\r\n                {\r\n                    text: I18n.t(\"common.OK\"),\r\n                    onPress: () =\u003e null\r\n                }\r\n            ]\r\n        );\r\n    } catch (error) {\r\n        if (error.error \u0026\u0026 error.error.code === \"ECANCELLED500\") {\r\n            console.warn(\"canceled\");\r\n        } else {\r\n            Alert.alert(\r\n                null,\r\n                I18n.t(\"myHealth.DownloadFailed\"),\r\n                [\r\n                    {\r\n                        text: I18n.t(\"common.OK\"),\r\n                        onPress: () =\u003e null\r\n                    }\r\n                ]\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\n```\r\n\r\n\r\n","url":"https://github.com/gwl002/gwl002.github.io/issues/6","createdAt":"2021-06-22T12:55:44Z","tags":[{"name":"react-native","color":"5319e7"}],"headType":"article"},"__N_SSG":true},"page":"/article/[id]","query":{"id":"4c3e4ca0899dd22eeb674d05e4811887"},"buildId":"next-build","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-7b08e4c67f4f1b892f4b.js"></script><script src="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" async=""></script><script src="/_next/static/chunks/framework-a905968bdef42c973edb.js" async=""></script><script src="/_next/static/chunks/main-593aa47955db315fed75.js" async=""></script><script src="/_next/static/chunks/pages/_app-d5cc49017566d8f84508.js" async=""></script><script src="/_next/static/chunks/252-594c4aef779f4680464f.js" async=""></script><script src="/_next/static/chunks/pages/article/%5Bid%5D-d59325b5a90cee2c7259.js" async=""></script><script src="/_next/static/next-build/_buildManifest.js" async=""></script><script src="/_next/static/next-build/_ssgManifest.js" async=""></script></body></html>