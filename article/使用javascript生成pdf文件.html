<!DOCTYPE html><html><head><link rel="shortcut icon" href="/favicon.ico?"/><link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/80ecf925bd8a20094a30.css" as="style"/><link rel="stylesheet" href="/_next/static/css/80ecf925bd8a20094a30.css" data-n-g=""/><link rel="preload" href="/_next/static/css/f09c6eb4242f80d565a9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f09c6eb4242f80d565a9.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-c179ed8d0295df0a6019.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-c5e6ccd6db559e171f21.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-f567f31a830b296ff0f9.js" as="script"/><link rel="preload" href="/_next/static/chunks/401-935ba5ad3ecc2a045d50.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/article/%5Btitle%5D-f9ae8855ac1b2f726a6a.js" as="script"/></head><body><div id="__next"><nav class="navbar_navbar__1EgTS"><div class="navbar_containerFluid__3lQQx"><a href="/" class="navbar_navbarHeader__25-ag">æš®å¤©äº‘å…‰</a><ul class="navbar_nav__6ovd1"><li><a href="/">HOME</a></li><li><a href="/about">å…³äº</a></li><li><a href="/game">å°æ¸¸æˆ</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/tag">æ ‡ç­¾</a></li></ul><button class="navbar_navToggle__1WISG" id="nav-toggle"><span class="navbar_iconBar__10AK6"></span><span class="navbar_iconBar__10AK6 navbar_mid__E-C7Y"></span><span class="navbar_iconBar__10AK6"></span></button></div></nav><header class="header_header__2q1wF"><div class="container"><div class="column"><div class="content"><div class="header_articleHeading__CG-Mk"><div class="header_tags__1EkWf"><a href="/tag#%E5%B7%A5%E4%BD%9C%E7%BB%8F%E9%AA%8C">å·¥ä½œç»éªŒ</a></div><h1>ä½¿ç”¨javascriptç”Ÿæˆpdfæ–‡ä»¶</h1><span class="header_meta__pX6i-">Posted by gwl002 on <!-- -->2021-06-06</span></div></div></div></div></header><article><div class="container"><div class="column"><div class="content"><div class="article_article__15ETi"><p>ä¸€ä¸ªæ•™è‚²ç½‘ç«™é¡¹ç›®æœ‰ä¸ªéœ€æ±‚ï¼Œéœ€è¦åœ¨å­¦å‘˜å®ŒæˆæŸäº›æµ‹è¯•åç”Ÿæˆè¯ä¹¦å¹¶ä¸‹è½½ã€‚æœ¬ä»¥ä¸ºåº”è¯¥æ˜¯è°ƒç”¨åç«¯çš„æ¥å£ç”Ÿæˆï¼Œä½†æ˜¯åç«¯ä¹Ÿè¯´ä¸å¤ªæ‡‚ï¼Œåªå¥½å‰ç«¯æ¥ç ”ç©¶ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚googleä¸€ä¸‹åå‘ç°æ¯”è¾ƒé è°±çš„æœ‰2ç§æ–¹æ¡ˆã€‚</p>
<ul>
<li>ä½¿ç”¨jspdfå’Œhtml2canvasè¿™2ä¸ªåº“åœ¨å‰ç«¯å®ç°</li>
<li>ä½¿ç”¨nodejsé€šè¿‡puppeteer åœ¨åç«¯ç”Ÿæˆ</li>
</ul>
<p>ä¸‹é¢åˆ†åˆ«è¯´è¯´è¿™2ç§æ–¹æ³•çš„å®ç°ã€‚</p>
<h1>ä½¿ç”¨jspdfç”Ÿæˆpdf</h1>
<p>é¦–å…ˆç¼–å†™pdfæ¨¡ç‰ˆçš„html(æˆ‘è¿™é‡Œæ˜¯ç”¨reactå†™çš„)ã€‚</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">Cert</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">    </span><span class="token token" style="color:#ffcb6b">chineseName</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">chineseName</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">    </span><span class="token token" style="color:#ffcb6b">englishName</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">englishName</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">    </span><span class="token token" style="color:#ffcb6b">unitInfo</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">unitInfo</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178"></span><span class="token token" style="color:#89ddff">/&gt;</span></code></div></pre>
<p>å› ä¸ºè¿™ä¸ªæ¨¡ç‰ˆåªæ˜¯ç”¨æ¥ç”Ÿæˆpdfï¼Œå¹¶ä¸ç”¨æ˜¾ç¤ºï¼Œæ‰€ä»¥é€šè¿‡csså°†å…¶æ”¾åœ¨è§†é‡ä¹‹å¤–ã€‚</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-css" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#ffcb6b">.cert</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">width</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">870</span><span class="token token" style="color:#f07178">px</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">height</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">615</span><span class="token token" style="color:#f07178">px</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">position</span><span class="token token" style="color:#89ddff">:</span><span> absolute</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    // </span><span class="token token" style="color:#80cbc4">background</span><span class="token token" style="color:#89ddff">:</span><span class="token token" style="color:#f2ff00">transparent</span><span> </span><span class="token token" style="color:#c792ea">url</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">$imgData</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    // </span><span class="token token" style="color:#80cbc4">background-size</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">100</span><span class="token token" style="color:#f07178">%</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    // </span><span class="token token" style="color:#80cbc4">top</span><span class="token token" style="color:#89ddff">:</span><span class="token token" style="color:#fd9170">-30</span><span class="token token" style="color:#f07178">px</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">left</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">5000</span><span class="token token" style="color:#f07178">px</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">visibility</span><span class="token token" style="color:#89ddff">:</span><span> hidden</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">z-index</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">99</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<p>æ ¸å¿ƒä»£ç ,å…ˆç”¨html2canvaså°†htmlè½¬æˆcanvasï¼Œå†å°†canvasè½¬æˆimage dataurlï¼Œå†å°†imageå†™å…¥pdfä¸­ã€‚</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">savePDF</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">async</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea">setIsLoading</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">true</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">try</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> jsPDF </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token module" style="color:#c792ea;font-style:italic">import</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;jspdf&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token module" style="color:#c792ea;font-style:italic">default</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">//å¼•å…¥jspdf</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> html2canvas </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token module" style="color:#c792ea;font-style:italic">import</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;html2canvas&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token module" style="color:#c792ea;font-style:italic">default</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">//å¼•å…¥html2canvas</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> canvas </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token" style="color:#c792ea">html2canvas</span><span class="token token" style="color:#89ddff">(</span><span class="token token dom" style="color:#f07178">document</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">querySelector</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;#cert&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>            scrollY</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span>  </span><span class="token token" style="color:#546e7a">//ä¸è®¾ç½®æ­¤å±æ€§ æ»šåŠ¨è§†å›¾æ—¶ä¼šå¯¼è‡´ä¸‹è½½çš„pdfæœ‰éƒ¨åˆ†ä¸æ˜¾ç¤º</span><span>
</span><span>            </span><span class="token token function-variable" style="color:#c792ea">onclone</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">clonedDoc</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                clonedDoc</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">getElementById</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;cert&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">style</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">visibility</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;visible&#x27;</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">//å°†pdfæ¨¡ç‰ˆè®¾ä¸ºå¯è§</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> imgData </span><span class="token token" style="color:#89ddff">=</span><span> canvas</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">toDataURL</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;image/png&#x27;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> doc </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">jsPDF</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;l&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;mm&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;a4&quot;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">true</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span> 
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> width </span><span class="token token" style="color:#89ddff">=</span><span> doc</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">internal</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">pageSize</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">getWidth</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> height </span><span class="token token" style="color:#89ddff">=</span><span> doc</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">internal</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">pageSize</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">getHeight</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        doc</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">addImage</span><span class="token token" style="color:#89ddff">(</span><span>imgData</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;PNG&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span> width</span><span class="token token" style="color:#89ddff">,</span><span> height</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;&quot;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;FAST&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">//FAST æ˜¯å¦å‹ç¼©</span><span>
</span><span>        </span><span class="token token" style="color:#546e7a">// let pdf = doc.output(&#x27;blob&#x27;);</span><span>
</span><span>        </span><span class="token token" style="color:#546e7a">// let form = new FormData();</span><span>
</span><span>        doc</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">output</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;save&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;Certificate.pdf&#x27;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">catch</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>err</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">log</span><span class="token token" style="color:#89ddff">(</span><span>err</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">finally</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea">setIsLoading</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">false</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<p>è¿™å°±å¤§åŠŸå‘Šæˆäº†ï¼Ÿé«˜å…´çš„å¤ªæ—©ï¼ğŸ˜­ğŸ˜­ğŸ˜­é—®é¢˜æ€»æ˜¯å±‚å‡ºä¸ç©·çš„å¤šã€‚åœ¨ç”¨æ­¤æ–¹æ³•ä¸­ä¸€å…±é‡åˆ°ä¸‰ä¸ªè¾ƒå¤§çš„é—®é¢˜ã€‚</p>
<ol>
<li>åˆæ­¥å®ç°åŠŸèƒ½æäº¤åï¼Œä¸€å¤©qaçªç„¶å’Œæˆ‘è¯´æ€ä¹ˆç”Ÿæˆçš„pdfä¸ŠåŠéƒ¨åˆ†æ˜¯ç©ºç™½çš„ã€‚æ²¡åŠæ³•ï¼Œæ‰¾æ‰¾æ‰¾ã€‚é€šè¿‡googleï¼Œå‘ç°æ˜¯html2canvasæ—¶ä¼šæ ¹æ®ç”¨æˆ·æ»šåŠ¨çš„ä½ç½®æ¥è®¡ç®—çš„ï¼Œè®¾ç½®scrollY: 0è§£å†³ã€‚</li>
<li>ä¹‹å‰åœ¨devåœºä¸­æµ‹è¯•å¹¶æ²¡æœ‰å‘ç°é—®é¢˜ï¼Œä½†æ˜¯ä¸Šäº†uatåå‘ç°pdfä¸­å›¾ç‰‡æ²¡åŠ è½½ã€‚æœ€åå‘ç°æ˜¯å› ä¸ºuatåœºå›¾ç‰‡å…¨éƒ¨æ”¾åœ¨äº†cdnçš„ç¼˜æ•…ï¼Œpdfä¸ä¼šåŠ è½½éåŒæºç«™çš„å›¾ç‰‡ä¹Ÿå°±è·¨åŸŸï¼Œè®¾ç½®useCORSä¹Ÿæ²¡æœ‰ç”¨ã€‚æœ€åç›´æ¥æŠŠpdfä¸­ç”¨åˆ°çš„å›¾ç‰‡æ¢æˆbase64è§£å†³ã€‚</li>
<li>ä¸åŒçš„æµè§ˆå™¨å’Œè®¾å¤‡ç”Ÿæˆçš„pdfæ–‡ä»¶sizeä¸åŒã€‚æœ‰çš„åªæœ‰å‡ M,æœ‰çš„åå‡ Mã€‚è¿™ä¸ªåº”è¯¥å’Œè®¾å¤‡çš„åˆ†è¾¨ç‡æœ‰å…³ã€‚è®¾ç½®äº†æ˜¯å¦å‹ç¼©ï¼Œå¯ä»¥è°ƒèŠ‚pdfçš„sizeï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•ç»Ÿä¸€ç”Ÿæˆçš„pdfçš„sizeã€‚</li>
</ol>
<h1>ä½¿ç”¨puppeteeråç«¯ç”Ÿæˆpdf</h1>
<p>åšè¿‡çˆ¬è™«çš„åº”è¯¥éƒ½å¬è¿‡é¼é¼å¤§åçš„phantomjsï¼Œå½“å¹´è¿™ä¸ªåº“å¾ˆç«ï¼Œå¯ä»¥è¯´æ˜¯ä¸€äº›æ¯”è¾ƒå¤æ‚ç½‘ç«™çš„çˆ¬è™«æœ€ç»ˆè§£å†³æ–¹æ¡ˆã€‚å› ä¸ºå®ƒå¯ä»¥è®©ä½ ç”¨jsæ“ä½œä¸€ä¸ªçœŸæ­£çš„æµè§ˆå™¨å»è®¿é—®ç½‘ç«™ã€‚puppeteeræ˜¯googleæ¨å‡ºçš„headless chromeï¼Œå¯ä»¥è¯´æ˜¯phantomjsçš„æ›¿ä»£å“ï¼Œè‡ªä»è¿™ä¸ªåº“å‡ºä¸–ï¼Œphantomjså¥½åƒå°±åœæ­¢ç»´æŠ¤äº†ã€‚</p>
<blockquote>
<p>Puppeteer is a Node library which provides a high-level API to control Chrome or Chromium over the DevTools Protocol. Puppeteer runs headless by default, but can be configured to run full (non-headless) Chrome or Chromium.</p>
</blockquote>
<p>ä¸ºäº†è§£å†³ä¸Šé¢è¯´çš„ä¸åŒè®¾å¤‡ç”Ÿæˆçš„pdf sizeä¸åŒçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨puppeteeræ¥åœ¨åç«¯ç”Ÿæˆpdfã€‚
å› ä¸ºç”Ÿæˆçš„è¯ä¹¦å¦‚å§“åæˆç»©ä¹‹ç±»çš„æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥è¦ç”¨æ¨¡ç‰ˆåŠ¨æ€ç”Ÿæˆï¼Œå› ä¸ºæˆ‘çš„é¡¹ç›®æ˜¯reactï¼Œæ‰€ä»¥ç›´æ¥ç”¨jsxç”Ÿæˆæ¨¡æ¿ï¼Œç”¨rendertostringç”Ÿæˆhtmlå­—ç¬¦ä¸²ã€‚ä¹Ÿæœ‰ä¸€äº›styleå’Œå›¾ç‰‡å¤„ç†æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥çœ‹æˆ‘ä»£ç ï¼Œä½†æ˜¯è¿™é‡Œåªæ˜¯ç®€å•å®ç°ã€‚</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#c792ea">PdfTemplate</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter" style="color:#89ddff">{</span><span class="token token parameter"> imgSrc </span><span class="token token parameter" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">className</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">bg</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">h2</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">heading</span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">h2</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token template-string" style="color:#c3e88d">                content
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">img</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">src</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">imgSrc</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">alt</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">style</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178"> width</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#c3e88d">&quot;100%&quot;</span><span class="token token script language-javascript" style="color:#89ddff">,</span><span class="token token script language-javascript" style="color:#f07178"> height</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#fd9170">300</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">        </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">)</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span>
</span>
<span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">createHtmlStr</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> imagePath </span><span class="token token" style="color:#89ddff">=</span><span> __dirname </span><span class="token token" style="color:#89ddff">+</span><span> </span><span class="token token" style="color:#c3e88d">&quot;/../../../../public/images/bg.jpeg&quot;</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> imgData </span><span class="token token" style="color:#89ddff">=</span><span> fs</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">readFileSync</span><span class="token token" style="color:#89ddff">(</span><span>imagePath</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">toString</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;base64&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> imgSrc </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token template-string template-punctuation" style="color:#c3e88d">`</span><span class="token token template-string" style="color:#c3e88d">data:image/jpeg;base64,</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#89ddff">${</span><span class="token token template-string interpolation">imgData</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#89ddff">}</span><span class="token token template-string template-punctuation" style="color:#c3e88d">`</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> content </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token maybe-class-name">ReactDOMServer</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">renderToString</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">PdfTemplate</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">imgSrc</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">imgSrc</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token template-string template-punctuation" style="color:#c3e88d">`</span><span class="token token template-string" style="color:#c3e88d">
</span><span class="token token template-string" style="color:#c3e88d">        &lt;html&gt;
</span><span class="token token template-string" style="color:#c3e88d">            &lt;head&gt;
</span><span class="token token template-string" style="color:#c3e88d">                &lt;style&gt;
</span><span class="token token template-string" style="color:#c3e88d">                    html,body{
</span><span class="token token template-string" style="color:#c3e88d">                        margin:0;
</span><span class="token token template-string" style="color:#c3e88d">                        padding:0;
</span><span class="token token template-string" style="color:#c3e88d">                        height:100%
</span><span class="token token template-string" style="color:#c3e88d">                    }
</span><span class="token token template-string" style="color:#c3e88d">                    .bg{
</span><span class="token token template-string" style="color:#c3e88d">                        height:100%;
</span><span class="token token template-string" style="color:#c3e88d">                        position:relative;
</span><span class="token token template-string" style="color:#c3e88d">                    }
</span><span class="token token template-string" style="color:#c3e88d">                &lt;/style&gt;
</span><span class="token token template-string" style="color:#c3e88d">            &lt;/head&gt;
</span><span class="token token template-string" style="color:#c3e88d">            &lt;body&gt;
</span><span class="token token template-string" style="color:#c3e88d">                </span><span class="token token template-string interpolation interpolation-punctuation" style="color:#89ddff">${</span><span class="token token template-string interpolation">content</span><span class="token token template-string interpolation interpolation-punctuation" style="color:#89ddff">}</span><span class="token token template-string" style="color:#c3e88d">
</span><span class="token token template-string" style="color:#c3e88d">            &lt;/body&gt;
</span><span class="token token template-string" style="color:#c3e88d">        &lt;/html&gt;
</span><span class="token token template-string" style="color:#c3e88d">    </span><span class="token token template-string template-punctuation" style="color:#c3e88d">`</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<p>åç«¯ä»£ç </p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-javascript" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token module" style="color:#c792ea;font-style:italic">export</span><span> </span><span class="token token module" style="color:#c792ea;font-style:italic">default</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">async</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">function</span><span> </span><span class="token token" style="color:#c792ea">handler</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">req</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> res</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">log</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;start&quot;</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> browser </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> puppeteer</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">launch</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        args</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#89ddff">[</span><span class="token token" style="color:#c3e88d">&#x27;--disable-dev-shm-usage&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;--no-sandbox&#x27;</span><span class="token token" style="color:#89ddff">]</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> page </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> browser</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">newPage</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> html </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">createHtmlStr</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">log</span><span class="token token" style="color:#89ddff">(</span><span>html</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;====&quot;</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>    </span><span class="token token" style="color:#546e7a">// await page.goto(&quot;http://localhost:3000/&quot;);</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> page</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">setContent</span><span class="token token" style="color:#89ddff">(</span><span>html</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> pdf </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> page</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">pdf</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        format</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;A4&#x27;</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        printBackground</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c792ea">true</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        </span><span class="token token" style="color:#c3e88d">&#x27;-webkit-print-color-adjust&#x27;</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;exact&#x27;</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> browser</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">close</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">log</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;end render&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    res</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">setHeader</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;Content-Type&quot;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;application/pdf&#x27;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    res</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">status</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">200</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    res</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">send</span><span class="token token" style="color:#89ddff">(</span><span>pdf</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span>
</span>
</code></div></pre>
<p>å‰ç«¯ä»£ç </p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-javascript" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>  </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">downloadPDF</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">async</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>          </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> response </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token" style="color:#c792ea">fetch</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;/api/createPdf&quot;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>              responseType</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;arraybuffer&#x27;</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>              headers</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                  </span><span class="token token" style="color:#c3e88d">&#x27;Accept&#x27;</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;application/pdf&#x27;</span><span>
</span><span>              </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>          </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>          </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> blob </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> response</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">blob</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>          </span><span class="token token" style="color:#546e7a">// const blob = new Blob([response.body], { type: &#x27;application/pdf&#x27; })</span><span>
</span><span>          </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> link </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token dom" style="color:#f07178">document</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">createElement</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;a&#x27;</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>          link</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">href</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token dom" style="color:#f07178">window</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#c792ea">URL</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">createObjectURL</span><span class="token token" style="color:#89ddff">(</span><span>blob</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>          link</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">download</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token template-string template-punctuation" style="color:#c3e88d">`</span><span class="token token template-string" style="color:#c3e88d">your-file-name.pdf</span><span class="token token template-string template-punctuation" style="color:#c3e88d">`</span><span>
</span><span>          link</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">click</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>  </span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<h1>æ€»ç»“</h1>
<ol>
<li>åœ¨å‰ç«¯é€šè¿‡æˆªå±htmlå…ƒç´ ç”Ÿæˆpdfï¼Œç®€å•æ–¹ä¾¿ï¼Œä¸éœ€è¦åç«¯é…åˆï¼Œç›´æ¥åœ¨å‰ç«¯ç”Ÿæˆpdfï¼Œç¼ºç‚¹å°±æ˜¯ç”Ÿæˆçš„pdfæ–‡ä»¶å¤§å°ä¸ç»Ÿä¸€ã€‚</li>
<li>åœ¨åç«¯ç”¨puppeteerç”Ÿæˆpdfï¼Œå¯ä»¥è§£å†³ä¸Šè¿°æ–¹æ³•çš„é—®é¢˜ï¼Œä½†æ˜¯è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æ¥å£ï¼Œéœ€è¦åŠ ä¸€ä¸ªnodeæœåŠ¡ï¼Œè¿™ä¸ªé¡¹ç›®å› ä¸ºæˆ‘ä»¬æ˜¯ç”¨nextjså†™çš„ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿çš„åŠ ä¸€ä¸ªapiæ¥å£ã€‚ä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬çš„åç«¯éƒ½æ˜¯javaå†™çš„ï¼Œè¦é¢å¤–çš„å¼€ä¸€ä¸ªnodeæœåŠ¡ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ã€‚</li>
</ol></div><div class="home_sidebar__31WDI"><section><h5><a href="/tags">FEATURED TAGS</a></h5><ul><li class="home_tag__bnOVo"><a href="/tag#%E5%B7%A5%E4%BD%9C%E7%BB%8F%E9%AA%8C">å·¥ä½œç»éªŒ</a></li></ul></section></div></div></div></div></article><footer class="footer_footer__1cByA"><div class="footer_copywriting__2a9K7"><p>Copyright Â© æš®å¤©äº‘å…‰ <!-- -->2021</p><p><span>Posted by Â <a href="https://github.com/gwl002" target="_blank" rel="noopener">gwl002</a></span><span>Â |Â è®¢é˜…æœ¬ç«™<iframe style="margin-left:2px;margin-bottom:-5px" frameBorder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=gwl002&amp;repo=gwl002.github.io&amp;type=star&amp;count=false"></iframe></span></p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"ä½¿ç”¨javascriptç”Ÿæˆpdfæ–‡ä»¶","body":"ä¸€ä¸ªæ•™è‚²ç½‘ç«™é¡¹ç›®æœ‰ä¸ªéœ€æ±‚ï¼Œéœ€è¦åœ¨å­¦å‘˜å®ŒæˆæŸäº›æµ‹è¯•åç”Ÿæˆè¯ä¹¦å¹¶ä¸‹è½½ã€‚æœ¬ä»¥ä¸ºåº”è¯¥æ˜¯è°ƒç”¨åç«¯çš„æ¥å£ç”Ÿæˆï¼Œä½†æ˜¯åç«¯ä¹Ÿè¯´ä¸å¤ªæ‡‚ï¼Œåªå¥½å‰ç«¯æ¥ç ”ç©¶ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚googleä¸€ä¸‹åå‘ç°æ¯”è¾ƒé è°±çš„æœ‰2ç§æ–¹æ¡ˆã€‚\r\n\r\n- ä½¿ç”¨jspdfå’Œhtml2canvasè¿™2ä¸ªåº“åœ¨å‰ç«¯å®ç°\r\n- ä½¿ç”¨nodejsé€šè¿‡puppeteer åœ¨åç«¯ç”Ÿæˆ\r\n\r\nä¸‹é¢åˆ†åˆ«è¯´è¯´è¿™2ç§æ–¹æ³•çš„å®ç°ã€‚\r\n\r\n# ä½¿ç”¨jspdfç”Ÿæˆpdf\r\n\r\n\r\né¦–å…ˆç¼–å†™pdfæ¨¡ç‰ˆçš„html(æˆ‘è¿™é‡Œæ˜¯ç”¨reactå†™çš„)ã€‚\r\n```jsx\r\n\u003cCert\r\n    chineseName={chineseName}\r\n    englishName={englishName}\r\n    unitInfo={unitInfo}\r\n/\u003e\r\n```\r\nå› ä¸ºè¿™ä¸ªæ¨¡ç‰ˆåªæ˜¯ç”¨æ¥ç”Ÿæˆpdfï¼Œå¹¶ä¸ç”¨æ˜¾ç¤ºï¼Œæ‰€ä»¥é€šè¿‡csså°†å…¶æ”¾åœ¨è§†é‡ä¹‹å¤–ã€‚\r\n```css\r\n.cert {\r\n    width: 870px;\r\n    height: 615px;\r\n    position: absolute;\r\n    // background:transparent url($imgData) ;\r\n    // background-size: 100%;\r\n    // top:-30px;\r\n    left: 5000px;\r\n    visibility: hidden;\r\n    z-index: 99;\r\n}\r\n```\r\næ ¸å¿ƒä»£ç ,å…ˆç”¨html2canvaså°†htmlè½¬æˆcanvasï¼Œå†å°†canvasè½¬æˆimage dataurlï¼Œå†å°†imageå†™å…¥pdfä¸­ã€‚\r\n```jsx\r\nconst savePDF = async () =\u003e {\r\n    setIsLoading(true);\r\n    try {\r\n        const jsPDF = (await import(\"jspdf\")).default; //å¼•å…¥jspdf\r\n        const html2canvas = (await import(\"html2canvas\")).default; //å¼•å…¥html2canvas\r\n        let canvas = await html2canvas(document.querySelector(\"#cert\"), {\r\n            scrollY: 0,  //ä¸è®¾ç½®æ­¤å±æ€§ æ»šåŠ¨è§†å›¾æ—¶ä¼šå¯¼è‡´ä¸‹è½½çš„pdfæœ‰éƒ¨åˆ†ä¸æ˜¾ç¤º\r\n            onclone: (clonedDoc) =\u003e {\r\n                clonedDoc.getElementById(\"cert\").style.visibility = 'visible'; //å°†pdfæ¨¡ç‰ˆè®¾ä¸ºå¯è§\r\n            }\r\n        })\r\n        var imgData = canvas.toDataURL('image/png');\r\n        var doc = new jsPDF('l', 'mm', \"a4\", true); \r\n        var width = doc.internal.pageSize.getWidth();\r\n        var height = doc.internal.pageSize.getHeight();\r\n        doc.addImage(imgData, 'PNG', 0, 0, width, height, \"\", \"FAST\"); //FAST æ˜¯å¦å‹ç¼©\r\n        // let pdf = doc.output('blob');\r\n        // let form = new FormData();\r\n        doc.output('save', 'Certificate.pdf');\r\n    } catch (err) {\r\n        console.log(err);\r\n    } finally {\r\n        setIsLoading(false)\r\n    }\r\n}\r\n```\r\nè¿™å°±å¤§åŠŸå‘Šæˆäº†ï¼Ÿé«˜å…´çš„å¤ªæ—©ï¼ğŸ˜­ğŸ˜­ğŸ˜­é—®é¢˜æ€»æ˜¯å±‚å‡ºä¸ç©·çš„å¤šã€‚åœ¨ç”¨æ­¤æ–¹æ³•ä¸­ä¸€å…±é‡åˆ°ä¸‰ä¸ªè¾ƒå¤§çš„é—®é¢˜ã€‚\r\n\r\n1. åˆæ­¥å®ç°åŠŸèƒ½æäº¤åï¼Œä¸€å¤©qaçªç„¶å’Œæˆ‘è¯´æ€ä¹ˆç”Ÿæˆçš„pdfä¸ŠåŠéƒ¨åˆ†æ˜¯ç©ºç™½çš„ã€‚æ²¡åŠæ³•ï¼Œæ‰¾æ‰¾æ‰¾ã€‚é€šè¿‡googleï¼Œå‘ç°æ˜¯html2canvasæ—¶ä¼šæ ¹æ®ç”¨æˆ·æ»šåŠ¨çš„ä½ç½®æ¥è®¡ç®—çš„ï¼Œè®¾ç½®scrollY: 0è§£å†³ã€‚\r\n2. ä¹‹å‰åœ¨devåœºä¸­æµ‹è¯•å¹¶æ²¡æœ‰å‘ç°é—®é¢˜ï¼Œä½†æ˜¯ä¸Šäº†uatåå‘ç°pdfä¸­å›¾ç‰‡æ²¡åŠ è½½ã€‚æœ€åå‘ç°æ˜¯å› ä¸ºuatåœºå›¾ç‰‡å…¨éƒ¨æ”¾åœ¨äº†cdnçš„ç¼˜æ•…ï¼Œpdfä¸ä¼šåŠ è½½éåŒæºç«™çš„å›¾ç‰‡ä¹Ÿå°±è·¨åŸŸï¼Œè®¾ç½®useCORSä¹Ÿæ²¡æœ‰ç”¨ã€‚æœ€åç›´æ¥æŠŠpdfä¸­ç”¨åˆ°çš„å›¾ç‰‡æ¢æˆbase64è§£å†³ã€‚\r\n3. ä¸åŒçš„æµè§ˆå™¨å’Œè®¾å¤‡ç”Ÿæˆçš„pdfæ–‡ä»¶sizeä¸åŒã€‚æœ‰çš„åªæœ‰å‡ M,æœ‰çš„åå‡ Mã€‚è¿™ä¸ªåº”è¯¥å’Œè®¾å¤‡çš„åˆ†è¾¨ç‡æœ‰å…³ã€‚è®¾ç½®äº†æ˜¯å¦å‹ç¼©ï¼Œå¯ä»¥è°ƒèŠ‚pdfçš„sizeï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•ç»Ÿä¸€ç”Ÿæˆçš„pdfçš„sizeã€‚\r\n\r\n# ä½¿ç”¨puppeteeråç«¯ç”Ÿæˆpdf \r\n\r\nåšè¿‡çˆ¬è™«çš„åº”è¯¥éƒ½å¬è¿‡é¼é¼å¤§åçš„phantomjsï¼Œå½“å¹´è¿™ä¸ªåº“å¾ˆç«ï¼Œå¯ä»¥è¯´æ˜¯ä¸€äº›æ¯”è¾ƒå¤æ‚ç½‘ç«™çš„çˆ¬è™«æœ€ç»ˆè§£å†³æ–¹æ¡ˆã€‚å› ä¸ºå®ƒå¯ä»¥è®©ä½ ç”¨jsæ“ä½œä¸€ä¸ªçœŸæ­£çš„æµè§ˆå™¨å»è®¿é—®ç½‘ç«™ã€‚puppeteeræ˜¯googleæ¨å‡ºçš„headless chromeï¼Œå¯ä»¥è¯´æ˜¯phantomjsçš„æ›¿ä»£å“ï¼Œè‡ªä»è¿™ä¸ªåº“å‡ºä¸–ï¼Œphantomjså¥½åƒå°±åœæ­¢ç»´æŠ¤äº†ã€‚\r\n\r\n\u003e  Puppeteer is a Node library which provides a high-level API to control Chrome or Chromium over the DevTools Protocol. Puppeteer runs headless by default, but can be configured to run full (non-headless) Chrome or Chromium.\r\n\r\nä¸ºäº†è§£å†³ä¸Šé¢è¯´çš„ä¸åŒè®¾å¤‡ç”Ÿæˆçš„pdf sizeä¸åŒçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨puppeteeræ¥åœ¨åç«¯ç”Ÿæˆpdfã€‚\r\nå› ä¸ºç”Ÿæˆçš„è¯ä¹¦å¦‚å§“åæˆç»©ä¹‹ç±»çš„æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥è¦ç”¨æ¨¡ç‰ˆåŠ¨æ€ç”Ÿæˆï¼Œå› ä¸ºæˆ‘çš„é¡¹ç›®æ˜¯reactï¼Œæ‰€ä»¥ç›´æ¥ç”¨jsxç”Ÿæˆæ¨¡æ¿ï¼Œç”¨rendertostringç”Ÿæˆhtmlå­—ç¬¦ä¸²ã€‚ä¹Ÿæœ‰ä¸€äº›styleå’Œå›¾ç‰‡å¤„ç†æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥çœ‹æˆ‘ä»£ç ï¼Œä½†æ˜¯è¿™é‡Œåªæ˜¯ç®€å•å®ç°ã€‚\r\n\r\n```jsx\r\nconst PdfTemplate = ({ imgSrc }) =\u003e {\r\n    return (\r\n        \u003cdiv className=\"bg\"\u003e\r\n            \u003ch2\u003eheading\u003c/h2\u003e\r\n            \u003cdiv\u003e\r\n                content\r\n            \u003c/div\u003e\r\n            \u003cimg src={imgSrc} alt=\"\" style={{ width: \"100%\", height: 300 }} /\u003e\r\n        \u003c/div\u003e\r\n    )\r\n}\r\n\r\nconst createHtmlStr = () =\u003e {\r\n    const imagePath = __dirname + \"/../../../../public/images/bg.jpeg\";\r\n    const imgData = fs.readFileSync(imagePath).toString(\"base64\");\r\n    const imgSrc = `data:image/jpeg;base64,${imgData}`;\r\n    const content = ReactDOMServer.renderToString(\u003cPdfTemplate imgSrc={imgSrc} /\u003e)\r\n    return `\r\n        \u003chtml\u003e\r\n            \u003chead\u003e\r\n                \u003cstyle\u003e\r\n                    html,body{\r\n                        margin:0;\r\n                        padding:0;\r\n                        height:100%\r\n                    }\r\n                    .bg{\r\n                        height:100%;\r\n                        position:relative;\r\n                    }\r\n                \u003c/style\u003e\r\n            \u003c/head\u003e\r\n            \u003cbody\u003e\r\n                ${content}\r\n            \u003c/body\u003e\r\n        \u003c/html\u003e\r\n    `\r\n}\r\n```\r\nåç«¯ä»£ç \r\n```javascript\r\nexport default async function handler(req, res) {\r\n    console.log(\"start\")\r\n    const browser = await puppeteer.launch({\r\n        args: ['--disable-dev-shm-usage', '--no-sandbox']\r\n    });\r\n    const page = await browser.newPage();\r\n    ;\r\n    const html = createHtmlStr();\r\n    console.log(html, \"====\")\r\n    // await page.goto(\"http://localhost:3000/\");\r\n    await page.setContent(html);\r\n    const pdf = await page.pdf({\r\n        format: 'A4',\r\n        printBackground: true,\r\n        '-webkit-print-color-adjust': 'exact',\r\n    });\r\n    await browser.close();\r\n    console.log(\"end render\");\r\n    res.setHeader(\"Content-Type\", 'application/pdf');\r\n    res.status(200);\r\n    res.send(pdf);\r\n}\r\n\r\n```\r\nå‰ç«¯ä»£ç \r\n```javascript\r\n  const downloadPDF = async () =\u003e {\r\n          let response = await fetch(\"/api/createPdf\", {\r\n              responseType: 'arraybuffer',\r\n              headers: {\r\n                  'Accept': 'application/pdf'\r\n              }\r\n          });\r\n          let blob = await response.blob();\r\n          // const blob = new Blob([response.body], { type: 'application/pdf' })\r\n          const link = document.createElement('a')\r\n          link.href = window.URL.createObjectURL(blob)\r\n          link.download = `your-file-name.pdf`\r\n          link.click()\r\n  }\r\n```\r\n# æ€»ç»“\r\n\r\n1. åœ¨å‰ç«¯é€šè¿‡æˆªå±htmlå…ƒç´ ç”Ÿæˆpdfï¼Œç®€å•æ–¹ä¾¿ï¼Œä¸éœ€è¦åç«¯é…åˆï¼Œç›´æ¥åœ¨å‰ç«¯ç”Ÿæˆpdfï¼Œç¼ºç‚¹å°±æ˜¯ç”Ÿæˆçš„pdfæ–‡ä»¶å¤§å°ä¸ç»Ÿä¸€ã€‚\r\n2. åœ¨åç«¯ç”¨puppeteerç”Ÿæˆpdfï¼Œå¯ä»¥è§£å†³ä¸Šè¿°æ–¹æ³•çš„é—®é¢˜ï¼Œä½†æ˜¯è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æ¥å£ï¼Œéœ€è¦åŠ ä¸€ä¸ªnodeæœåŠ¡ï¼Œè¿™ä¸ªé¡¹ç›®å› ä¸ºæˆ‘ä»¬æ˜¯ç”¨nextjså†™çš„ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿çš„åŠ ä¸€ä¸ªapiæ¥å£ã€‚ä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬çš„åç«¯éƒ½æ˜¯javaå†™çš„ï¼Œè¦é¢å¤–çš„å¼€ä¸€ä¸ªnodeæœåŠ¡ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ã€‚\r\n\r\n","url":"https://github.com/gwl002/gwl002.github.io/issues/2","createdAt":"2021-06-06T14:54:27Z","tags":["å·¥ä½œç»éªŒ"],"headType":"article"},"__N_SSG":true},"page":"/article/[title]","query":{"title":"ä½¿ç”¨javascriptç”Ÿæˆpdfæ–‡ä»¶"},"buildId":"next-build","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-7b08e4c67f4f1b892f4b.js"></script><script src="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" async=""></script><script src="/_next/static/chunks/framework-c179ed8d0295df0a6019.js" async=""></script><script src="/_next/static/chunks/main-c5e6ccd6db559e171f21.js" async=""></script><script src="/_next/static/chunks/pages/_app-f567f31a830b296ff0f9.js" async=""></script><script src="/_next/static/chunks/401-935ba5ad3ecc2a045d50.js" async=""></script><script src="/_next/static/chunks/pages/article/%5Btitle%5D-f9ae8855ac1b2f726a6a.js" async=""></script><script src="/_next/static/next-build/_buildManifest.js" async=""></script><script src="/_next/static/next-build/_ssgManifest.js" async=""></script></body></html>