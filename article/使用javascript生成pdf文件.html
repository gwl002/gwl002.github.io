<!DOCTYPE html><html><head><link rel="shortcut icon" href="/favicon.ico?"/><link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/38e5a5b4776088319b61.css" as="style"/><link rel="stylesheet" href="/_next/static/css/38e5a5b4776088319b61.css" data-n-g=""/><link rel="preload" href="/_next/static/css/32f82f3b0866cb69a29d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/32f82f3b0866cb69a29d.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-c179ed8d0295df0a6019.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-c5e6ccd6db559e171f21.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-80bd99636630a50e76c6.js" as="script"/><link rel="preload" href="/_next/static/chunks/149-092e2327758a2c34111b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/article/%5Btitle%5D-a013d506e75f6b118489.js" as="script"/></head><body><div id="__next"><nav class="navbar_navbar__1EgTS"><div class="navbar_containerFluid__3lQQx"><a href="/" class="navbar_navbarHeader__25-ag">暮天云光</a><ul class="navbar_nav__6ovd1"><li><a href="/">HOME</a></li><li><a href="/about">关于</a></li><li><a href="/game">小游戏</a></li><li><a href="/archives">归档</a></li><li><a href="/tag">标签</a></li></ul><button class="navbar_navToggle__1WISG" id="nav-toggle"><span class="navbar_iconBar__10AK6"></span><span class="navbar_iconBar__10AK6 navbar_mid__E-C7Y"></span><span class="navbar_iconBar__10AK6"></span></button></div></nav><header class="header_header__2q1wF"><div class="container"><div class="column"><div class="content"><div class="header_articleHeading__CG-Mk"><div class="header_tags__1EkWf"><a href="/tag#css">css</a></div><h1>使用javascript生成pdf文件</h1><span class="header_meta__pX6i-">Posted by gwl002 on <!-- -->2021-06-06</span></div></div></div></div></header><article><div class="container"><div class="column"><div class="content"><div class="article_article__15ETi"><p>一个教育网站项目有个需求，需要在学员完成某些测试后生成证书并下载。本以为应该是调用后端的接口生成，但是后端也说不太懂，只好前端来研究一下解决方案。google一下后发现比较靠谱的有2种方案。</p>
<ul>
<li>使用jspdf和html2canvas这2个库在前端实现</li>
<li>使用nodejs通过puppeteer 在后端生成</li>
</ul>
<p>下面分别说说这2种方法的实现。</p>
<h1>使用jspdf生成pdf</h1>
<p>首先编写pdf模版的html(我这里是用react写的)。</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">Cert</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">    </span><span class="token token" style="color:#ffcb6b">chineseName</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">chineseName</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">    </span><span class="token token" style="color:#ffcb6b">englishName</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">englishName</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">    </span><span class="token token" style="color:#ffcb6b">unitInfo</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">unitInfo</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178"></span><span class="token token" style="color:#89ddff">/&gt;</span></code></div></pre>
<p>因为这个模版只是用来生成pdf，并不用显示，所以通过css将其放在视野之外。</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-css" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#ffcb6b">.cert</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">width</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">870</span><span class="token token" style="color:#f07178">px</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">height</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">615</span><span class="token token" style="color:#f07178">px</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">position</span><span class="token token" style="color:#89ddff">:</span><span> absolute</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    // </span><span class="token token" style="color:#80cbc4">background</span><span class="token token" style="color:#89ddff">:</span><span class="token token" style="color:#f2ff00">transparent</span><span> </span><span class="token token" style="color:#c792ea">url</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#fd9170">$imgData</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    // </span><span class="token token" style="color:#80cbc4">background-size</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">100</span><span class="token token" style="color:#f07178">%</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    // </span><span class="token token" style="color:#80cbc4">top</span><span class="token token" style="color:#89ddff">:</span><span class="token token" style="color:#fd9170">-30</span><span class="token token" style="color:#f07178">px</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">left</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">5000</span><span class="token token" style="color:#f07178">px</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">visibility</span><span class="token token" style="color:#89ddff">:</span><span> hidden</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#80cbc4">z-index</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">99</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<p>核心代码,先用html2canvas将html转成canvas，再将canvas转成image dataurl，再将image写入pdf中。</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable" style="color:#c792ea">savePDF</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">async</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea">setIsLoading</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">true</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">try</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> jsPDF </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token module" style="color:#c792ea;font-style:italic">import</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;jspdf&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token module" style="color:#c792ea;font-style:italic">default</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">//引入jspdf</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> html2canvas </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token module" style="color:#c792ea;font-style:italic">import</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;html2canvas&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token module" style="color:#c792ea;font-style:italic">default</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">//引入html2canvas</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">let</span><span> canvas </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">await</span><span> </span><span class="token token" style="color:#c792ea">html2canvas</span><span class="token token" style="color:#89ddff">(</span><span class="token token dom" style="color:#f07178">document</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">querySelector</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;#cert&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>            scrollY</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span>  </span><span class="token token" style="color:#546e7a">//不设置此属性 滚动视图时会导致下载的pdf有部分不显示</span><span>
</span><span>            </span><span class="token token function-variable" style="color:#c792ea">onclone</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">clonedDoc</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                clonedDoc</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">getElementById</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&quot;cert&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">style</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">visibility</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;visible&#x27;</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">//将pdf模版设为可见</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> imgData </span><span class="token token" style="color:#89ddff">=</span><span> canvas</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">toDataURL</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;image/png&#x27;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> doc </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">new</span><span> </span><span class="token token" style="color:#f2ff00">jsPDF</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;l&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;mm&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;a4&quot;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c792ea">true</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span> 
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> width </span><span class="token token" style="color:#89ddff">=</span><span> doc</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">internal</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">pageSize</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">getWidth</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea;font-style:italic">var</span><span> height </span><span class="token token" style="color:#89ddff">=</span><span> doc</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">internal</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">pageSize</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">getHeight</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>        doc</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">addImage</span><span class="token token" style="color:#89ddff">(</span><span>imgData</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;PNG&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span> width</span><span class="token token" style="color:#89ddff">,</span><span> height</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;&quot;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&quot;FAST&quot;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span> </span><span class="token token" style="color:#546e7a">//FAST 是否压缩</span><span>
</span><span>        </span><span class="token token" style="color:#546e7a">// let pdf = doc.output(&#x27;blob&#x27;);</span><span>
</span><span>        </span><span class="token token" style="color:#546e7a">// let form = new FormData();</span><span>
</span><span>        doc</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">output</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c3e88d">&#x27;save&#x27;</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#c3e88d">&#x27;Certificate.pdf&#x27;</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">catch</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>err</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token console" style="color:#f2ff00">console</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">log</span><span class="token token" style="color:#89ddff">(</span><span>err</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">finally</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token" style="color:#c792ea">setIsLoading</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">false</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<p>这就大功告成了？高兴的太早！😭😭😭问题总是层出不穷的多。在用此方法中一共遇到三个较大的问题。</p>
<ol>
<li>初步实现功能提交后，一天qa突然和我说怎么生成的pdf上半部分是空白的。没办法，找找找。通过google，发现是html2canvas时会根据用户滚动的位置来计算的，设置scrollY: 0解决。</li>
<li>之前在dev场中测试并没有发现问题，但是上了uat后发现pdf中图片没加载。最后发现是因为uat场图片全部放在了cdn的缘故，pdf不会加载非同源站的图片也就跨域，设置useCORS也没有用。最后直接把pdf中用到的图片换成base64解决。</li>
<li>不同的浏览器和设备生成的pdf文件size不同。有的只有几M,有的十几M。这个应该和设备的分辨率有关。设置了是否压缩，可以调节pdf的size，但是还是无法统一生成的pdf的size。</li>
</ol>
<h1>使用puppeteer后端生成pdf</h1></div></div></div></div></article><footer class="footer_footer__1cByA"><div><div class="footer_copywriting__2a9K7"><p>Copyright © 暮天云光 <!-- -->2021</p><p><span>Posted by  <a href="https://github.com/gwl002" target="_blank" rel="noopener">gwl002</a></span><span> | 订阅本站<iframe style="margin-left:2px;margin-bottom:-5px" frameBorder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=gwl002&amp;repo=gwl002.github.io&amp;type=star&amp;count=false"></iframe></span></p></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"使用javascript生成pdf文件","body":"一个教育网站项目有个需求，需要在学员完成某些测试后生成证书并下载。本以为应该是调用后端的接口生成，但是后端也说不太懂，只好前端来研究一下解决方案。google一下后发现比较靠谱的有2种方案。\r\n\r\n- 使用jspdf和html2canvas这2个库在前端实现\r\n- 使用nodejs通过puppeteer 在后端生成\r\n\r\n下面分别说说这2种方法的实现。\r\n\r\n# 使用jspdf生成pdf\r\n\r\n首先编写pdf模版的html(我这里是用react写的)。\r\n```jsx\r\n\u003cCert\r\n    chineseName={chineseName}\r\n    englishName={englishName}\r\n    unitInfo={unitInfo}\r\n/\u003e\r\n```\r\n因为这个模版只是用来生成pdf，并不用显示，所以通过css将其放在视野之外。\r\n```css\r\n.cert {\r\n    width: 870px;\r\n    height: 615px;\r\n    position: absolute;\r\n    // background:transparent url($imgData) ;\r\n    // background-size: 100%;\r\n    // top:-30px;\r\n    left: 5000px;\r\n    visibility: hidden;\r\n    z-index: 99;\r\n}\r\n```\r\n核心代码,先用html2canvas将html转成canvas，再将canvas转成image dataurl，再将image写入pdf中。\r\n```jsx\r\nconst savePDF = async () =\u003e {\r\n    setIsLoading(true);\r\n    try {\r\n        const jsPDF = (await import(\"jspdf\")).default; //引入jspdf\r\n        const html2canvas = (await import(\"html2canvas\")).default; //引入html2canvas\r\n        let canvas = await html2canvas(document.querySelector(\"#cert\"), {\r\n            scrollY: 0,  //不设置此属性 滚动视图时会导致下载的pdf有部分不显示\r\n            onclone: (clonedDoc) =\u003e {\r\n                clonedDoc.getElementById(\"cert\").style.visibility = 'visible'; //将pdf模版设为可见\r\n            }\r\n        })\r\n        var imgData = canvas.toDataURL('image/png');\r\n        var doc = new jsPDF('l', 'mm', \"a4\", true); \r\n        var width = doc.internal.pageSize.getWidth();\r\n        var height = doc.internal.pageSize.getHeight();\r\n        doc.addImage(imgData, 'PNG', 0, 0, width, height, \"\", \"FAST\"); //FAST 是否压缩\r\n        // let pdf = doc.output('blob');\r\n        // let form = new FormData();\r\n        doc.output('save', 'Certificate.pdf');\r\n    } catch (err) {\r\n        console.log(err);\r\n    } finally {\r\n        setIsLoading(false)\r\n    }\r\n}\r\n```\r\n这就大功告成了？高兴的太早！😭😭😭问题总是层出不穷的多。在用此方法中一共遇到三个较大的问题。\r\n\r\n1. 初步实现功能提交后，一天qa突然和我说怎么生成的pdf上半部分是空白的。没办法，找找找。通过google，发现是html2canvas时会根据用户滚动的位置来计算的，设置scrollY: 0解决。\r\n2. 之前在dev场中测试并没有发现问题，但是上了uat后发现pdf中图片没加载。最后发现是因为uat场图片全部放在了cdn的缘故，pdf不会加载非同源站的图片也就跨域，设置useCORS也没有用。最后直接把pdf中用到的图片换成base64解决。\r\n3. 不同的浏览器和设备生成的pdf文件size不同。有的只有几M,有的十几M。这个应该和设备的分辨率有关。设置了是否压缩，可以调节pdf的size，但是还是无法统一生成的pdf的size。\r\n\r\n# 使用puppeteer后端生成pdf\r\n\r\n","url":"https://github.com/gwl002/gwl002.github.io/issues/2","createdAt":"2021-06-06T14:54:27Z","tags":["css"],"headType":"article"},"__N_SSG":true},"page":"/article/[title]","query":{"title":"使用javascript生成pdf文件"},"buildId":"next-build","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-7b08e4c67f4f1b892f4b.js"></script><script src="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" async=""></script><script src="/_next/static/chunks/framework-c179ed8d0295df0a6019.js" async=""></script><script src="/_next/static/chunks/main-c5e6ccd6db559e171f21.js" async=""></script><script src="/_next/static/chunks/pages/_app-80bd99636630a50e76c6.js" async=""></script><script src="/_next/static/chunks/149-092e2327758a2c34111b.js" async=""></script><script src="/_next/static/chunks/pages/article/%5Btitle%5D-a013d506e75f6b118489.js" async=""></script><script src="/_next/static/next-build/_buildManifest.js" async=""></script><script src="/_next/static/next-build/_ssgManifest.js" async=""></script></body></html>