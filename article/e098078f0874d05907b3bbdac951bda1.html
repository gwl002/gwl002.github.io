<!DOCTYPE html><html><head><link rel="shortcut icon" href="/favicon.ico?"/><link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DGNKE718G"></script><script>
                                    window.dataLayer = window.dataLayer || [];
                                    function gtag(){dataLayer.push(arguments);}
                                    gtag('js', new Date());
                                    gtag('config', 'G-3DGNKE718G');
                                    </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="记录工作学习兴趣爱好笔记"/><meta property="og:description" content="记录工作学习兴趣爱好笔记"/><meta http-equiv="x-ua-compatible" content="IE=edge; chrome=1"/><meta name="application-name" content="gwl002&#x27;s blog"/><title>暮天云光-react-native-webview加载第三方iframe</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta property="og:title" content="暮天云光-react-native-webview加载第三方iframe"/><meta name="keywords" content=""/><meta name="next-head-count" content="11"/><link rel="preload" href="/_next/static/css/76b56e34ae5f447eb5e2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/76b56e34ae5f447eb5e2.css" data-n-g=""/><link rel="preload" href="/_next/static/css/4138b3afe24f1964067e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4138b3afe24f1964067e.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-a905968bdef42c973edb.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-593aa47955db315fed75.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-e7cee9c7c954823642de.js" as="script"/><link rel="preload" href="/_next/static/chunks/252-594c4aef779f4680464f.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/article/%5Bid%5D-d59325b5a90cee2c7259.js" as="script"/></head><body><div id="__next"><nav class="navbar_navbar__1EgTS"><div class="navbar_containerFluid__3lQQx"><a class="navbar_navbarHeader__25-ag" href="/">暮天云光</a><ul class="navbar_nav__6ovd1"><li><a href="/">HOME</a></li><li><a href="/about">关于</a></li><li><a href="/game">小游戏</a></li><li><a href="/archives">归档</a></li><li><a href="/tag">标签</a></li></ul><button class="navbar_navToggle__1WISG" id="nav-toggle"><span class="navbar_iconBar__10AK6"></span><span class="navbar_iconBar__10AK6 navbar_mid__E-C7Y"></span><span class="navbar_iconBar__10AK6"></span></button></div></nav><header class="header_header__2q1wF"><div class="container"><div class="column"><div class="content"><div class="header_articleHeading__CG-Mk"><div class="header_tags__1EkWf"><a href="/tag#javascript">javascript</a><a href="/tag#react-native">react-native</a></div><h1>react-native-webview加载第三方iframe</h1><span class="header_meta__pX6i-">Posted by gwl002 on <!-- -->2022-04-11</span></div></div></div></div></header><article><div class="container"><div class="column"><div class="content"><div class="article_article__15ETi"><h3>1. 第三方iframe 遇到cross-origin问题</h3>
<p><a href="https://github.com/react-native-webview/react-native-webview/blob/master/docs/Reference.md#">设置baseUrl与iframe的domain相同</a></p>
<pre><code class="language-(javascript)" node="[object Object]"></code></pre>
<h3>2.  通过postMessage 向rn发送event</h3>
<pre><code class="language-(javascript)" node="[object Object]"></code></pre>
<h3>3. <a href="https://github.com/react-native-webview/react-native-webview/blob/master/docs/Debugging.md#:~:text=Open%20Safari%20Preferences%20%2D%3E%20%22Advanced,you%20would%20on%20the%20web">react-native中调试js</a></h3>
<h3>3.1 ios中调试js</h3>
<ol>
<li>Open Safari Preferences -&gt; &quot;Advanced&quot; tab -&gt; enable checkbox &quot;Show Develop menu in menu bar&quot;</li>
<li>Start app with React Native WebView in iOS simulator or iOS device</li>
<li>Safari -&gt; Develop -&gt; [device name] -&gt; [app name] -&gt; [url - title]</li>
<li>You can now debug the WebView contents just as you would on the web</li>
</ol>
<h3>3.2 android中调试js</h3>
<ol>
<li>You will need to make the following change to MainApplication.java to enabled web contents debugging:</li>
</ol>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-java" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">import</span><span> </span><span class="token token">android</span><span class="token token" style="color:#89ddff">.</span><span class="token token">webkit</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#f2ff00">WebView</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>  </span><span class="token token annotation" style="color:#89ddff">@Override</span><span>
</span><span>  </span><span class="token token" style="color:#c792ea;font-style:italic">public</span><span> </span><span class="token token" style="color:#c792ea;font-style:italic">void</span><span> </span><span class="token token" style="color:#c792ea">onCreate</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">super</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#c792ea">onCreate</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>	  </span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#89ddff">.</span><span>
</span><span>    </span><span class="token token" style="color:#f2ff00">WebView</span><span class="token token" style="color:#89ddff">.</span><span class="token token" style="color:#c792ea">setWebContentsDebuggingEnabled</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#c792ea">true</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>  </span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<ol start="2">
<li>Start app with React Native WebView in Android emulator or Android device</li>
<li>Open chrome://inspect/#devices on Chrome</li>
<li>Select your device on the left and select &quot;Inspect&quot; on the WebView contents you&#x27;d like to inspect</li>
<li>You can now debug the WebView contents just as you would on the web</li>
</ol>
<h3>4. html source code</h3>
<pre><code class="language-(html)" node="[object Object]"></code></pre><hr/></div><strong class="article_remark__Gs6Yc"><a href="https://github.com/gwl002/gwl002.github.io/issues/14">在github上参与本文讨论</a></strong><div class="home_sidebar__31WDI"><section><h5><a href="/tags">FEATURED TAGS</a></h5><ul><li class="home_tag__bnOVo"><a href="/tag#javascript">javascript</a></li><li class="home_tag__bnOVo"><a href="/tag#react-native">react-native</a></li></ul></section></div></div></div></div></article><footer class="footer_footer__1cByA"><div class="footer_copywriting__2a9K7"><p>Copyright © 暮天云光 <!-- -->2022</p><p><span>Posted by  <a href="https://github.com/gwl002" target="_blank" rel="noopener noreferrer">gwl002</a></span><span> | 订阅本站<iframe style="margin-left:2px;margin-bottom:-5px" frameBorder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=gwl002&amp;repo=gwl002.github.io&amp;type=star&amp;count=false"></iframe></span></p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"e098078f0874d05907b3bbdac951bda1","title":"react-native-webview加载第三方iframe","body":"### 1. 第三方iframe 遇到cross-origin问题\r\n[设置baseUrl与iframe的domain相同](https://github.com/react-native-webview/react-native-webview/blob/master/docs/Reference.md#)\r\n```(javascript)\r\nconst ChatModal = ({ uuid, token, language, isLogin, dispatch, chatModal }) =\u003e {\r\n    const { shown } = chatModal;\r\n    // const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const closeModal = () =\u003e {\r\n        dispatch({\r\n            type: 'modal/closeChatModal',\r\n        });\r\n    };\r\n\r\n    const handleMessage = ({ nativeEvent }) =\u003e {\r\n        const data = nativeEvent.data;\r\n        if (data === 'close') {\r\n            closeModal();\r\n        }\r\n    };\r\n\r\n    return (\r\n        \u003cModal animationType=\"fade\" transparent={false} visible={shown}\u003e\r\n            \u003cSafeAreaView style={styles.container}\u003e\r\n                \u003cWebView\r\n                    source={{ html: html, baseUrl: 'https://chat.sleekflow.io/' }}\r\n                    style={styles.webview}\r\n                    onMessage={handleMessage}\r\n                /\u003e\r\n            \u003c/SafeAreaView\u003e\r\n        \u003c/Modal\u003e\r\n    );\r\n};\r\n```\r\n### 2.  通过postMessage 向rn发送event\r\n```(javascript)\r\nrootWindow.ReactNativeWebView.postMessage('close'); \r\n```\r\n\r\n### 3. [react-native中调试js](https://github.com/react-native-webview/react-native-webview/blob/master/docs/Debugging.md#:~:text=Open%20Safari%20Preferences%20%2D%3E%20%22Advanced,you%20would%20on%20the%20web)\r\n### 3.1 ios中调试js\r\n\r\n1. Open Safari Preferences -\u003e \"Advanced\" tab -\u003e enable checkbox \"Show Develop menu in menu bar\"\r\n2. Start app with React Native WebView in iOS simulator or iOS device\r\n3. Safari -\u003e Develop -\u003e [device name] -\u003e [app name] -\u003e [url - title]\r\n4. You can now debug the WebView contents just as you would on the web\r\n\r\n### 3.2 android中调试js\r\n\r\n1. You will need to make the following change to MainApplication.java to enabled web contents debugging: \r\n```java\r\nimport android.webkit.WebView;\r\n\r\n  @Override\r\n  public void onCreate() {\r\n    super.onCreate();\r\n\t  ...\r\n    WebView.setWebContentsDebuggingEnabled(true);\r\n  }\r\n```\r\n2. Start app with React Native WebView in Android emulator or Android device\r\n3. Open chrome://inspect/#devices on Chrome\r\n4. Select your device on the left and select \"Inspect\" on the WebView contents you'd like to inspect\r\n5. You can now debug the WebView contents just as you would on the web\r\n\r\n### 4. html source code\r\n```(html)\r\n\u003c!DOCTYPE html\u003e\r\n\u003chtml lang=\"en\"\u003e\r\n    \u003chead\u003e\r\n        \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\"\u003e\r\n        \u003cstyle\u003e\r\n            html,body{\r\n                margin:0;\r\n                padding:0\r\n            }\r\n            #loading-overlay{\r\n                position:absolute;\r\n                width:100%;\r\n                height:100vh;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                z-index:2147483647;\r\n                background-color:white;\r\n            }\r\n            .lds-spinner {\r\n            color: official;\r\n            display: inline-block;\r\n            position: relative;\r\n            width: 80px;\r\n            height: 80px;\r\n            transform:scale(0.8)\r\n            }\r\n            .lds-spinner div {\r\n            transform-origin: 40px 40px;\r\n            animation: lds-spinner 1.2s linear infinite;\r\n            }\r\n            .lds-spinner div:after {\r\n            content: \" \";\r\n            display: block;\r\n            position: absolute;\r\n            top: 3px;\r\n            left: 37px;\r\n            width: 6px;\r\n            height: 18px;\r\n            border-radius: 20%;\r\n            background: blue;\r\n            }\r\n            .lds-spinner div:nth-child(1) {\r\n            transform: rotate(0deg);\r\n            animation-delay: -1.1s;\r\n            }\r\n            .lds-spinner div:nth-child(2) {\r\n            transform: rotate(30deg);\r\n            animation-delay: -1s;\r\n            }\r\n            .lds-spinner div:nth-child(3) {\r\n            transform: rotate(60deg);\r\n            animation-delay: -0.9s;\r\n            }\r\n            .lds-spinner div:nth-child(4) {\r\n            transform: rotate(90deg);\r\n            animation-delay: -0.8s;\r\n            }\r\n            .lds-spinner div:nth-child(5) {\r\n            transform: rotate(120deg);\r\n            animation-delay: -0.7s;\r\n            }\r\n            .lds-spinner div:nth-child(6) {\r\n            transform: rotate(150deg);\r\n            animation-delay: -0.6s;\r\n            }\r\n            .lds-spinner div:nth-child(7) {\r\n            transform: rotate(180deg);\r\n            animation-delay: -0.5s;\r\n            }\r\n            .lds-spinner div:nth-child(8) {\r\n            transform: rotate(210deg);\r\n            animation-delay: -0.4s;\r\n            }\r\n            .lds-spinner div:nth-child(9) {\r\n            transform: rotate(240deg);\r\n            animation-delay: -0.3s;\r\n            }\r\n            .lds-spinner div:nth-child(10) {\r\n            transform: rotate(270deg);\r\n            animation-delay: -0.2s;\r\n            }\r\n            .lds-spinner div:nth-child(11) {\r\n            transform: rotate(300deg);\r\n            animation-delay: -0.1s;\r\n            }\r\n            .lds-spinner div:nth-child(12) {\r\n            transform: rotate(330deg);\r\n            animation-delay: 0s;\r\n            }\r\n            @keyframes lds-spinner {\r\n            0% {\r\n                opacity: 1;\r\n            }\r\n            100% {\r\n                opacity: 0;\r\n            }\r\n            }\r\n        \u003c/style\u003e\r\n    \u003c/head\u003e\r\n    \u003cbody\u003e\r\n        \u003cdiv id=\"loading-overlay\"\u003e\r\n            \u003cdiv class=\"lds-spinner\"\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003cdiv\u003e\u003c/div\u003e\u003c/div\u003e\r\n        \u003c/div\u003e\r\n    \u003c/body\u003e\r\n    \u003cscript \r\n        src=\"https://chat.sleekflow.io/embed_iframe.js\" \r\n        data-id=\"travischatwidget\"\r\n        data-companyid=\"e1922105-8004-4724-97c7-859b7ff5dedf\"\r\n        type=\"text/javascript\"\r\n    \u003e\r\n    \u003c/script\u003e\r\n    \u003cscript\u003e\r\n        const rootWindow = window;\r\n        const loadingEle = document.querySelector('#loading-overlay') //loading\r\n\r\n        function start(){\r\n            function checkLoad(iframe){\r\n                const iframeWindow = iframe.contentWindow.window;\r\n                const rootIframeEle = iframeWindow.document.getElementById(\"travischatroot\");\r\n                const floatButton = rootIframeEle.querySelector(\"div\u003ebutton\")\r\n                if(floatButton){\r\n                    floatButton.click();\r\n                    setTimeout(() =\u003e {\r\n                        loadingEle.remove();\r\n                        const closeButton = rootIframeEle.querySelector(\"#scrollConatiner\u003ediv\u003ebutton\")\r\n                        if(closeButton){\r\n                            closeButton.onclick = function(e){\r\n                                e.stopPropagation()\r\n                                rootWindow.ReactNativeWebView.postMessage('close'); \r\n                            }\r\n                        }\r\n                    }, 500);\r\n                }else{\r\n                    setTimeout(function(){\r\n                        checkLoad(iframe);\r\n                    },500)\r\n                }\r\n            }\r\n\r\n            const iframeEle = document.querySelector('iframe#travischatwidget')\r\n            if(iframeEle){\r\n                iframeEle.addEventListener('load',function(){\r\n                    checkLoad(iframeEle)\r\n                })\r\n            }else{\r\n                setTimeout(function(){\r\n                    start()\r\n                },500)\r\n            }\r\n        }\r\n        \r\n        window.onload = function(){\r\n            start();\r\n        }\r\n    \u003c/script\u003e \r\n\u003c/html\u003e\r\n```\r\n\r\n","url":"https://github.com/gwl002/gwl002.github.io/issues/14","createdAt":"2022-04-11T14:40:39Z","tags":[{"name":"javascript","color":"1d76db"},{"name":"react-native","color":"5319e7"}],"headType":"article"},"__N_SSG":true},"page":"/article/[id]","query":{"id":"e098078f0874d05907b3bbdac951bda1"},"buildId":"next-build","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-7b08e4c67f4f1b892f4b.js"></script><script src="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" async=""></script><script src="/_next/static/chunks/framework-a905968bdef42c973edb.js" async=""></script><script src="/_next/static/chunks/main-593aa47955db315fed75.js" async=""></script><script src="/_next/static/chunks/pages/_app-e7cee9c7c954823642de.js" async=""></script><script src="/_next/static/chunks/252-594c4aef779f4680464f.js" async=""></script><script src="/_next/static/chunks/pages/article/%5Bid%5D-d59325b5a90cee2c7259.js" async=""></script><script src="/_next/static/next-build/_buildManifest.js" async=""></script><script src="/_next/static/next-build/_ssgManifest.js" async=""></script></body></html>