<!DOCTYPE html><html><head><link rel="shortcut icon" href="/favicon.ico?"/><link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-3DGNKE718G"></script><script>
                                    window.dataLayer = window.dataLayer || [];
                                    function gtag(){dataLayer.push(arguments);}
                                    gtag('js', new Date());
                                    gtag('config', 'G-3DGNKE718G');
                                    </script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge; chrome=1"/><meta name="application-name" content="gwl002&#x27;s blog"/><title>暮天云光-rxjs实现贪吃蛇小游戏</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="本文主要介绍使用rxjs和react实现一个经典的贪吃蛇游戏。"/><meta property="keywords" name="keywords" content="rxjs,游戏"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/80ecf925bd8a20094a30.css" as="style"/><link rel="stylesheet" href="/_next/static/css/80ecf925bd8a20094a30.css" data-n-g=""/><link rel="preload" href="/_next/static/css/16bba102fe5a890eed6f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/16bba102fe5a890eed6f.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-c179ed8d0295df0a6019.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-c5e6ccd6db559e171f21.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-6b2beebc4d20ad7591a1.js" as="script"/><link rel="preload" href="/_next/static/chunks/401-291d55935fe43c2f08a9.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/article/%5Btitle%5D-15eeb1cd24a08ecbe612.js" as="script"/></head><body><div id="__next"><nav class="navbar_navbar__1EgTS"><div class="navbar_containerFluid__3lQQx"><a href="/" class="navbar_navbarHeader__25-ag">暮天云光</a><ul class="navbar_nav__6ovd1"><li><a href="/">HOME</a></li><li><a href="/about">关于</a></li><li><a href="/game">小游戏</a></li><li><a href="/archives">归档</a></li><li><a href="/tag">标签</a></li></ul><button class="navbar_navToggle__1WISG" id="nav-toggle"><span class="navbar_iconBar__10AK6"></span><span class="navbar_iconBar__10AK6 navbar_mid__E-C7Y"></span><span class="navbar_iconBar__10AK6"></span></button></div></nav><header class="header_header__2q1wF"><div class="container"><div class="column"><div class="content"><div class="header_articleHeading__CG-Mk"><div class="header_tags__1EkWf"><a href="/tag#react">react</a></div><h1>rxjs实现贪吃蛇小游戏</h1><span class="header_meta__pX6i-">Posted by gwl002 on <!-- -->2021-06-10</span></div></div></div></div></header><article><div class="container"><div class="column"><div class="content"><div class="article_article__15ETi"><p>初识rxjs感觉惊奇，感觉很多复杂的逻辑好像用rxjs来写变得简单明了。断断续续得学习了一阵子，感觉很好，却一直没有真正在项目中使用过。到底用不用rxjs很纠结，为了小需求而引入rxjs好像没那个必要，如果项目整体都换成rxjs对于过去的开发思路冲击太大，rxjs毕竟还是比较小众，其他同事也不一定会乐意学习使用。学习而不使用过不了多久就会忘记，所以这次写一个小demo来加深一下印象。那么写什么好呢，想到以前用react写过贪吃蛇小游戏，据说rxjs很适合用来开发游戏类程序，所以决定用rxjs来写一个经典的贪吃蛇小游戏。</p>
<p>本文并不介绍rxjs原理和各种操作符的使用，主要解释一下实现的逻辑。推荐几个我经常学习的网站：</p>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10186103">30 天精通 RxJS (00)： 關於本系列文章</a> 台湾同胞早年写的教程，写的很好，从原理到使用都讲的很好，还有一些生动的例子，虽然版本和写法已经有些不同，但并不影响学习。</li>
<li><a href="https://rxjs.dev/">官网</a></li>
<li><a href="https://www.learnrxjs.io/">Learn Rxjs</a>很好的学习网站，每个操作符的解释和例子，以及各种demo。</li>
</ul>
<h1>实现UI</h1>
<p>首先看一下整体的界面，包括Board(蛇移动的范围)、Snake(红色）、Food(绿色)、Score(分数)、暂停和重置按钮。这里我们使用react来渲染视图，当然也可以用canvas，我们只注重于逻辑，不关心ui。我们采取数据驱动视图的思维开发，逻辑和页面元素是解耦合，这种思维可以让我们很轻松从react渲染切换到canvas渲染。</p>
<p><img src="https://user-images.githubusercontent.com/18588945/122550390-291dea00-d066-11eb-8077-2a827aeccc11.png" alt="image"/></p>
<h3>Board</h3>
<p>这个结构是基本不变的，只渲染一次就够了，当然把gameover移除更好，懂react的应该理解为什么用memo。</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>
</span><span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#c792ea">GameOver</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter" style="color:#89ddff">{</span><span class="token token parameter"> isGameOver </span><span class="token token parameter" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">!</span><span>isGameOver</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token null nil" style="color:#c792ea;font-style:italic">null</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">h1</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">className</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">center</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">GAME OVER</span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">h1</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">)</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span>
</span>
<span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token maybe-class-name">Board</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">memo</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter" style="color:#89ddff">{</span><span class="token token parameter"> winWidth</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> size</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> isGameOver </span><span class="token token parameter" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> itemWidth </span><span class="token token" style="color:#89ddff">=</span><span> winWidth </span><span class="token token" style="color:#89ddff">/</span><span> size</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#c792ea">Row</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter" style="color:#89ddff">{</span><span class="token token parameter"> rowIndex </span><span class="token token parameter" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">className</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">rowContainer</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                    </span><span class="token token known-class-name" style="color:#f2ff00">Array</span><span class="token token" style="color:#89ddff">(</span><span>size</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">fill</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">map</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">item</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> index</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>                        </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">key</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">index</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">className</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">boardItem</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">style</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178"> width</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> itemWidth</span><span class="token token script language-javascript" style="color:#89ddff">,</span><span class="token token script language-javascript" style="color:#f07178"> height</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> itemWidth </span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                        </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>                    </span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>                </span><span class="token token" style="color:#89ddff">}</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span>
</span>
<span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">id</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">board</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                </span><span class="token token known-class-name" style="color:#f2ff00">Array</span><span class="token token" style="color:#89ddff">(</span><span>size</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">fill</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">map</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">item</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> index</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">Row</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">key</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">index</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token" style="color:#89ddff">)</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">}</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">GameOver</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">isGameOver</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">isGameOver</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">        </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">)</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span></code></div></pre>
<h3>Snake 和 Food</h3>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#c792ea">Food</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter" style="color:#89ddff">{</span><span class="token token parameter"> food</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> itemWidth </span><span class="token token parameter" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">if</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">!</span><span>food</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token null nil" style="color:#c792ea;font-style:italic">null</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">            </span><span class="token token" style="color:#ffcb6b">className</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">boardItem</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">            </span><span class="token token" style="color:#ffcb6b">style</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">
</span><span class="token token script language-javascript" style="color:#f07178">                position</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#c3e88d">&quot;absolute&quot;</span><span class="token token script language-javascript" style="color:#89ddff">,</span><span class="token token script language-javascript" style="color:#f07178">
</span><span class="token token script language-javascript" style="color:#f07178">                width</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> itemWidth</span><span class="token token script language-javascript" style="color:#89ddff">,</span><span class="token token script language-javascript" style="color:#f07178">
</span><span class="token token script language-javascript" style="color:#f07178">                height</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> itemWidth</span><span class="token token script language-javascript" style="color:#89ddff">,</span><span class="token token script language-javascript" style="color:#f07178">
</span><span class="token token script language-javascript" style="color:#f07178">                left</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> itemWidth </span><span class="token token script language-javascript" style="color:#89ddff">*</span><span class="token token script language-javascript" style="color:#f07178"> food</span><span class="token token script language-javascript" style="color:#89ddff">.</span><span class="token token script language-javascript property-access" style="color:#f07178">x</span><span class="token token script language-javascript" style="color:#89ddff">,</span><span class="token token script language-javascript" style="color:#f07178">
</span><span class="token token script language-javascript" style="color:#f07178">                top</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> itemWidth </span><span class="token token script language-javascript" style="color:#89ddff">*</span><span class="token token script language-javascript" style="color:#f07178"> food</span><span class="token token script language-javascript" style="color:#89ddff">.</span><span class="token token script language-javascript property-access" style="color:#f07178">y</span><span class="token token script language-javascript" style="color:#89ddff">,</span><span class="token token script language-javascript" style="color:#f07178">
</span><span class="token token script language-javascript" style="color:#f07178">                backgroundColor</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#c3e88d">&quot;green&quot;</span><span class="token token script language-javascript" style="color:#f07178">
</span><span class="token token script language-javascript" style="color:#f07178">            </span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178">
</span><span class="token token" style="color:#f07178">        </span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">        </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">)</span><span>
</span>
<span></span><span class="token token" style="color:#89ddff">}</span><span>
</span>
<span></span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token maybe-class-name">Snake</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">memo</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter" style="color:#89ddff">{</span><span class="token token parameter"> data</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> itemWidth </span><span class="token token parameter" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">{</span><span>data</span><span class="token token" style="color:#89ddff">.</span><span class="token token method property-access" style="color:#c792ea">map</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">(</span><span class="token token parameter">item</span><span class="token token parameter" style="color:#89ddff">,</span><span class="token token parameter"> index</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span>
</span><span>                </span><span class="token token" style="color:#89ddff">&lt;</span><span>span
</span><span>                    </span><span class="token token" style="color:#546e7a">// key={`${item.x}-${item.y}`}</span><span>
</span><span>                    key</span><span class="token token" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">{</span><span>index</span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>                    className</span><span class="token token" style="color:#89ddff">=</span><span class="token token" style="color:#c3e88d">&quot;boardItem&quot;</span><span>
</span><span>                    style</span><span class="token token" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">{</span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                        position</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c3e88d">&quot;absolute&quot;</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                        width</span><span class="token token" style="color:#89ddff">:</span><span> itemWidth</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                        height</span><span class="token token" style="color:#89ddff">:</span><span> itemWidth</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                        left</span><span class="token token" style="color:#89ddff">:</span><span> itemWidth </span><span class="token token" style="color:#89ddff">*</span><span> item</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">x</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                        top</span><span class="token token" style="color:#89ddff">:</span><span> itemWidth </span><span class="token token" style="color:#89ddff">*</span><span> item</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">y</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>                        backgroundColor</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c3e88d">&quot;red&quot;</span><span>
</span><span>                    </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">}</span><span>
</span><span>                </span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>                    </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>                </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>            </span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">}</span><span class="token token plain-text">
</span><span class="token token plain-text">        </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">)</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">)</span></code></div></pre>
<h3>App</h3>
<p>把各个组件整合起来</p>
<pre><div style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;position:relative;margin:0.5em 0;padding:1.25em 1em"><code class="language-jsx" style="text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#c3cee3;background:#263238;font-family:Roboto Mono, monospace;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token function-variable maybe-class-name" style="color:#c792ea">App</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span> </span><span class="token token arrow" style="color:#89ddff">=&gt;</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> size </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#fd9170">20</span><span class="token token" style="color:#89ddff">;</span><span>
</span><span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#89ddff">[</span><span>ref</span><span class="token token" style="color:#89ddff">,</span><span> </span><span class="token token" style="color:#89ddff">{</span><span> width </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">]</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">useMeasure</span><span class="token token" style="color:#89ddff">(</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> itemWidth </span><span class="token token" style="color:#89ddff">=</span><span> width </span><span class="token token" style="color:#89ddff">/</span><span> size</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> initialState </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>        isGameOver</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c792ea">false</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        score</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#fd9170">0</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        snake</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#89ddff">[</span><span>
</span>
<span>        </span><span class="token token" style="color:#89ddff">]</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        food</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token null nil" style="color:#c792ea;font-style:italic">null</span><span class="token token" style="color:#89ddff">,</span><span>
</span><span>        isPaused</span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c792ea">true</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">}</span><span>
</span>
<span>    </span><span class="token token" style="color:#c792ea;font-style:italic">const</span><span> </span><span class="token token" style="color:#89ddff">[</span><span>state</span><span class="token token" style="color:#89ddff">,</span><span> setState</span><span class="token token" style="color:#89ddff">]</span><span> </span><span class="token token" style="color:#89ddff">=</span><span> </span><span class="token token" style="color:#c792ea">useState</span><span class="token token" style="color:#89ddff">(</span><span>initialState</span><span class="token token" style="color:#89ddff">)</span><span class="token token" style="color:#89ddff">;</span><span>
</span>
<span>    </span><span class="token token control-flow" style="color:#c792ea;font-style:italic">return</span><span> </span><span class="token token" style="color:#89ddff">(</span><span>
</span><span>        </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">Head</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">link</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">rel</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">stylesheet</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">href</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">/styles/greedySnake.css</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f2ff00">Head</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">{</span><span>width </span><span class="token token" style="color:#89ddff">&gt;</span><span> </span><span class="token token" style="color:#fd9170">0</span><span> </span><span class="token token" style="color:#89ddff">?</span><span> </span><span class="token token null nil" style="color:#c792ea;font-style:italic">null</span><span> </span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">Loading</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token" style="color:#89ddff">}</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">className</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">snakeGame</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">ref</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">ref</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">style</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178"> visibility</span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> width </span><span class="token token script language-javascript" style="color:#89ddff">&gt;</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#fd9170">0</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#89ddff">?</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#c3e88d">&quot;visible&quot;</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#89ddff">:</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#c3e88d">&quot;hidden&quot;</span><span class="token token script language-javascript" style="color:#f07178"> </span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">Board</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">winWidth</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">width</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">size</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">size</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">isGameOver</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">state</span><span class="token token script language-javascript" style="color:#89ddff">.</span><span class="token token script language-javascript property-access" style="color:#f07178">isGameOver</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">Snake</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">itemWidth</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">itemWidth</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">data</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">state</span><span class="token token script language-javascript" style="color:#89ddff">.</span><span class="token token script language-javascript property-access" style="color:#f07178">snake</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f2ff00">Food</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">itemWidth</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">itemWidth</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">food</span><span class="token token script language-javascript script-punctuation" style="color:#f07178">=</span><span class="token token script language-javascript" style="color:#89ddff">{</span><span class="token token script language-javascript" style="color:#f07178">state</span><span class="token token script language-javascript" style="color:#89ddff">.</span><span class="token token script language-javascript property-access" style="color:#f07178">food</span><span class="token token script language-javascript" style="color:#89ddff">}</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#89ddff">/&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                    </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">button</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">id</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">pauseORresume</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token" style="color:#89ddff">{</span><span>
</span><span>                        state</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">isPaused</span><span> </span><span class="token token" style="color:#89ddff">?</span><span> </span><span class="token token" style="color:#c3e88d">&quot;START&quot;</span><span> </span><span class="token token" style="color:#89ddff">:</span><span> </span><span class="token token" style="color:#c3e88d">&quot;PAUSE&quot;</span><span>
</span><span>                    </span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">button</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                    </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">button</span><span class="token token" style="color:#f07178"> </span><span class="token token" style="color:#ffcb6b">id</span><span class="token token attr-equals" style="color:#89ddff">=</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#c3e88d">reset</span><span class="token token" style="color:#89ddff">&quot;</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">reset</span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">button</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">                </span><span class="token token" style="color:#89ddff">&lt;</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token" style="color:#89ddff">{</span><span>state</span><span class="token token" style="color:#89ddff">.</span><span class="token token property-access">score</span><span class="token token" style="color:#89ddff">}</span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">span</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">            </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#f07178">div</span><span class="token token" style="color:#89ddff">&gt;</span><span class="token token plain-text">
</span><span class="token token plain-text">        </span><span class="token token" style="color:#89ddff">&lt;/</span><span class="token token" style="color:#89ddff">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#89ddff">)</span><span>
</span><span></span><span class="token token" style="color:#89ddff">}</span></code></div></pre>
<p>现在我们已经实现了基本的页面，接下来我们要做的写游戏的逻辑驱动各元素动起来。</p><hr/></div><strong class="article_remark__Gs6Yc"><a href="https://github.com/gwl002/gwl002.github.io/issues/3">在github上参与本文讨论</a></strong><div class="home_sidebar__31WDI"><section><h5><a href="/tags">FEATURED TAGS</a></h5><ul><li class="home_tag__bnOVo"><a href="/tag#react">react</a></li></ul></section></div></div></div></div></article><footer class="footer_footer__1cByA"><div class="footer_copywriting__2a9K7"><p>Copyright © 暮天云光 <!-- -->2021</p><p><span>Posted by  <a href="https://github.com/gwl002" target="_blank" rel="noopener">gwl002</a></span><span> | 订阅本站<iframe style="margin-left:2px;margin-bottom:-5px" frameBorder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=gwl002&amp;repo=gwl002.github.io&amp;type=star&amp;count=false"></iframe></span></p></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"rxjs实现贪吃蛇小游戏","body":"初识rxjs感觉惊奇，感觉很多复杂的逻辑好像用rxjs来写变得简单明了。断断续续得学习了一阵子，感觉很好，却一直没有真正在项目中使用过。到底用不用rxjs很纠结，为了小需求而引入rxjs好像没那个必要，如果项目整体都换成rxjs对于过去的开发思路冲击太大，rxjs毕竟还是比较小众，其他同事也不一定会乐意学习使用。学习而不使用过不了多久就会忘记，所以这次写一个小demo来加深一下印象。那么写什么好呢，想到以前用react写过贪吃蛇小游戏，据说rxjs很适合用来开发游戏类程序，所以决定用rxjs来写一个经典的贪吃蛇小游戏。\r\n\r\n本文并不介绍rxjs原理和各种操作符的使用，主要解释一下实现的逻辑。推荐几个我经常学习的网站：\r\n\r\n- [30 天精通 RxJS (00)： 關於本系列文章](https://ithelp.ithome.com.tw/articles/10186103) 台湾同胞早年写的教程，写的很好，从原理到使用都讲的很好，还有一些生动的例子，虽然版本和写法已经有些不同，但并不影响学习。\r\n- [官网](https://rxjs.dev/)\r\n- [Learn Rxjs](https://www.learnrxjs.io/)很好的学习网站，每个操作符的解释和例子，以及各种demo。\r\n\r\n# 实现UI\r\n首先看一下整体的界面，包括Board(蛇移动的范围)、Snake(红色）、Food(绿色)、Score(分数)、暂停和重置按钮。这里我们使用react来渲染视图，当然也可以用canvas，我们只注重于逻辑，不关心ui。我们采取数据驱动视图的思维开发，逻辑和页面元素是解耦合，这种思维可以让我们很轻松从react渲染切换到canvas渲染。\r\n\r\n![image](https://user-images.githubusercontent.com/18588945/122550390-291dea00-d066-11eb-8077-2a827aeccc11.png)\r\n\r\n### Board \r\n这个结构是基本不变的，只渲染一次就够了，当然把gameover移除更好，懂react的应该理解为什么用memo。\r\n```jsx\r\n\r\nconst GameOver = ({ isGameOver }) =\u003e {\r\n    if (!isGameOver) return null;\r\n    return (\r\n        \u003ch1 className=\"center\"\u003eGAME OVER\u003c/h1\u003e\r\n    )\r\n}\r\n\r\nconst Board = memo(({ winWidth, size, isGameOver }) =\u003e {\r\n    const itemWidth = winWidth / size;\r\n\r\n    const Row = ({ rowIndex }) =\u003e {\r\n        return (\r\n            \u003cdiv className=\"rowContainer\"\u003e\r\n                {\r\n                    Array(size).fill().map((item, index) =\u003e (\r\n                        \u003cspan key={index} className=\"boardItem\" style={{ width: itemWidth, height: itemWidth }}\u003e\r\n                            \u003cspan\u003e\u003c/span\u003e\r\n                        \u003c/span\u003e\r\n                    ))\r\n                }\r\n            \u003c/div\u003e\r\n        )\r\n    }\r\n\r\n    return (\r\n        \u003cdiv id=\"board\"\u003e\r\n            {\r\n                Array(size).fill().map((item, index) =\u003e \u003cRow key={index} /\u003e)\r\n            }\r\n            \u003cGameOver isGameOver={isGameOver} /\u003e\r\n        \u003c/div\u003e\r\n    )\r\n})\r\n```\r\n### Snake 和 Food\r\n```jsx\r\nconst Food = ({ food, itemWidth }) =\u003e {\r\n    if (!food) return null;\r\n\r\n    return (\r\n        \u003cspan\r\n            className=\"boardItem\"\r\n            style={{\r\n                position: \"absolute\",\r\n                width: itemWidth,\r\n                height: itemWidth,\r\n                left: itemWidth * food.x,\r\n                top: itemWidth * food.y,\r\n                backgroundColor: \"green\"\r\n            }}\r\n        \u003e\r\n            \u003cspan\u003e\u003c/span\u003e\r\n        \u003c/span\u003e\r\n    )\r\n\r\n}\r\n\r\nconst Snake = memo(({ data, itemWidth }) =\u003e {\r\n    return (\r\n        \u003c\u003e\r\n            {data.map((item, index) =\u003e\r\n                \u003cspan\r\n                    // key={`${item.x}-${item.y}`}\r\n                    key={index}\r\n                    className=\"boardItem\"\r\n                    style={{\r\n                        position: \"absolute\",\r\n                        width: itemWidth,\r\n                        height: itemWidth,\r\n                        left: itemWidth * item.x,\r\n                        top: itemWidth * item.y,\r\n                        backgroundColor: \"red\"\r\n                    }}\r\n                \u003e\r\n                    \u003cspan\u003e\u003c/span\u003e\r\n                \u003c/span\u003e\r\n            )}\r\n        \u003c/\u003e\r\n    )\r\n})\r\n```\r\n### App\r\n把各个组件整合起来\r\n```jsx\r\nconst App = () =\u003e {\r\n    const size = 20;\r\n    const [ref, { width }] = useMeasure();\r\n\r\n    const itemWidth = width / size;\r\n\r\n    const initialState = {\r\n        isGameOver: false,\r\n        score: 0,\r\n        snake: [\r\n\r\n        ],\r\n        food: null,\r\n        isPaused: true\r\n    }\r\n\r\n    const [state, setState] = useState(initialState);\r\n\r\n    return (\r\n        \u003c\u003e\r\n            \u003cHead\u003e\r\n                \u003clink rel=\"stylesheet\" href=\"/styles/greedySnake.css\" /\u003e\r\n            \u003c/Head\u003e\r\n            {width \u003e 0 ? null : \u003cLoading /\u003e}\r\n            \u003cdiv className=\"snakeGame\" ref={ref} style={{ visibility: width \u003e 0 ? \"visible\" : \"hidden\" }}\u003e\r\n                \u003cBoard winWidth={width} size={size} isGameOver={state.isGameOver} /\u003e\r\n                \u003cSnake itemWidth={itemWidth} data={state.snake} /\u003e\r\n                \u003cFood itemWidth={itemWidth} food={state.food} /\u003e\r\n                \u003cdiv\u003e\r\n                    \u003cbutton id=\"pauseORresume\"\u003e{\r\n                        state.isPaused ? \"START\" : \"PAUSE\"\r\n                    }\u003c/button\u003e\r\n                \u003c/div\u003e\r\n                \u003cdiv\u003e\r\n                    \u003cbutton id=\"reset\"\u003ereset\u003c/button\u003e\r\n                \u003c/div\u003e\r\n                \u003cspan\u003e{state.score}\u003c/span\u003e\r\n            \u003c/div\u003e\r\n        \u003c/\u003e\r\n    )\r\n}\r\n```\r\n现在我们已经实现了基本的页面，接下来我们要做的写游戏的逻辑驱动各元素动起来。\r\n","url":"https://github.com/gwl002/gwl002.github.io/issues/3","createdAt":"2021-06-10T16:15:20Z","tags":["react"],"description":"本文主要介绍使用rxjs和react实现一个经典的贪吃蛇游戏。","keywords":["rxjs","游戏"],"headType":"article"},"__N_SSG":true},"page":"/article/[title]","query":{"title":"rxjs实现贪吃蛇小游戏"},"buildId":"next-build","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-7b08e4c67f4f1b892f4b.js"></script><script src="/_next/static/chunks/webpack-af8d060cb140570bcfb2.js" async=""></script><script src="/_next/static/chunks/framework-c179ed8d0295df0a6019.js" async=""></script><script src="/_next/static/chunks/main-c5e6ccd6db559e171f21.js" async=""></script><script src="/_next/static/chunks/pages/_app-6b2beebc4d20ad7591a1.js" async=""></script><script src="/_next/static/chunks/401-291d55935fe43c2f08a9.js" async=""></script><script src="/_next/static/chunks/pages/article/%5Btitle%5D-15eeb1cd24a08ecbe612.js" async=""></script><script src="/_next/static/next-build/_buildManifest.js" async=""></script><script src="/_next/static/next-build/_ssgManifest.js" async=""></script></body></html>