{"pageProps":{"list":[{"title":"ä½¿ç”¨imagemagicåˆ¶ä½œç“¦ç‰‡åœ°å›¾","body":"ä¹‹å‰æœ‰ä¸ªé¡¹ç›®å®¢æˆ·ç»™ä¸€å¼ ç²¾åº¦å¾ˆé«˜çš„å›¾è®©åšæˆé‚£ç§èƒ½å¤Ÿç¼©æ”¾çš„åœ°å›¾çš„æ•ˆæœã€‚ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯ç›´æ¥åŠ è½½å¤§å›¾ï¼Œç„¶åé€šè¿‡æ‰‹åŠ¿å»æ§åˆ¶å›¾ç‰‡çš„scaleæ¥å®ç°ï¼Œåæ¥è§‰å¾—ä¸å¦¥ï¼Œé«˜ç²¾åº¦å›¾ç‰‡çš„ä½“ç§¯å®åœ¨å¤ªå¤§ï¼ŒåŠ è½½æ—¶é—´å¤ªé•¿ï¼Œæ•ˆæœå¾ˆä¸å¥½ã€‚é€šè¿‡ç ”ç©¶å‘ç°[openlayers](https://openlayers.org/)è¿™ç§ä¸“é—¨ç”¨æ¥åŠ è½½åœ°å›¾çš„åº“æ‰æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯æ€ä¹ˆæŠŠå›¾ç‰‡åˆ¶ä½œæˆé‚£ç§ç“¦ç‰‡åœ°å›¾æ˜¯ä¸ªé—®é¢˜ã€‚\r\n\r\n>ç“¦ç‰‡åœ°å›¾é‡‘å­—å¡”æ¨¡å‹æ˜¯ä¸€ç§å¤šåˆ†è¾¨ç‡å±‚æ¬¡æ¨¡å‹ï¼Œä»ç“¦ç‰‡é‡‘å­—å¡”çš„åº•å±‚åˆ°é¡¶å±‚ï¼Œåˆ†è¾¨ç‡è¶Šæ¥è¶Šä½ï¼Œä½†è¡¨ç¤ºçš„åœ°ç†èŒƒå›´ä¸å˜ã€‚é¦–å…ˆç¡®å®šåœ°å›¾æœåŠ¡å¹³å°æ‰€è¦æä¾›çš„ç¼©æ”¾çº§åˆ«çš„æ•°é‡Nï¼ŒæŠŠç¼©æ”¾çº§åˆ«æœ€é«˜ã€åœ°å›¾æ¯”ä¾‹å°ºæœ€å¤§çš„åœ°å›¾å›¾ç‰‡ä½œä¸ºé‡‘å­—å¡”çš„åº•å±‚ï¼Œå³ç¬¬0å±‚ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆ†å—ï¼Œä»åœ°å›¾å›¾ç‰‡çš„å·¦ä¸Šè§’å¼€å§‹ï¼Œä»å·¦è‡³å³ã€ä»ä¸Šåˆ°ä¸‹è¿›è¡Œåˆ‡å‰²ï¼Œåˆ†å‰²æˆç›¸åŒå¤§å°(æ¯”å¦‚256x256åƒç´ )çš„æ­£æ–¹å½¢åœ°å›¾ç“¦ç‰‡ï¼Œå½¢æˆç¬¬0å±‚ç“¦ç‰‡çŸ©é˜µ;åœ¨ç¬¬0å±‚åœ°å›¾å›¾ç‰‡çš„åŸºç¡€ä¸Šï¼ŒæŒ‰æ¯åƒç´ åˆ†å‰²ä¸º2Ã—2ä¸ªåƒç´ çš„æ–¹æ³•ç”Ÿæˆç¬¬1å±‚åœ°å›¾å›¾ç‰‡ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆ†å—ï¼Œåˆ†å‰²æˆä¸ä¸‹ä¸€å±‚ç›¸åŒå¤§å°çš„æ­£æ–¹å½¢åœ°å›¾ç“¦ç‰‡ï¼Œå½¢æˆç¬¬1å±‚ç“¦ç‰‡çŸ©é˜µ;é‡‡ç”¨åŒæ ·çš„æ–¹æ³•ç”Ÿæˆç¬¬2å±‚ç“¦ç‰‡çŸ©é˜µ;â€¦;å¦‚æ­¤ä¸‹å»ï¼Œç›´åˆ°ç¬¬Nä¸€1å±‚ï¼Œæ„æˆæ•´ä¸ªç“¦ç‰‡é‡‘å­—å¡”ã€‚\r\n\r\n# åŸç†\r\nç“¦ç‰‡åœ°å›¾çš„åŸç†å¾ˆç®€å•ã€‚å‡è®¾å®¢æˆ·ç»™çš„åŸå›¾ä¸ºï¼ˆ512*4ï¼Œ512*4ï¼‰ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ°å›¾èƒ½å¤Ÿè¾¾åˆ°çš„æœ€é«˜åˆ†è¾¨ç‡ï¼Œä½†æ˜¯å‡è®¾æˆ‘ä»¬çš„è§†çª—åªæœ‰512*512ï¼Œæ­¤æ—¶æˆ‘ä»¬åªèƒ½çœ‹åˆ°å·¦ä¸Šè§’1/16çš„éƒ¨åˆ†ã€‚å‡è®¾ç”¨æˆ·æœ€å¼€å§‹çœ‹åˆ°çš„å›¾åŒ…å«æ•´ä¸ªåœ°å›¾ï¼Œä¹Ÿå°±æ˜¯512*512ï¼Œæ­¤æ—¶åœ°å›¾è¢«ç¼©æ”¾äº†16å€ï¼Œå®½é«˜ä¸ª4å€ï¼Œæ­¤æ—¶è®¾levelä¸º1ï¼Œé‚£ä¹ˆå½“æ”¾å¤§ä¸€å€æ—¶ï¼Œæ­¤æ—¶åœ°å›¾å®é™…å›¾ç‰‡å¤§å°ä¸ºï¼ˆ512*2ï¼Œ512*2ï¼‰ï¼Œæ­¤æ—¶levelä¸º2ï¼Œå½“å†æ”¾å¤§ä¸€å€æ—¶ï¼Œæ­¤æ—¶levelä¸º3ï¼Œåˆšå¥½ä¸ºåŸå›¾ï¼Œåˆ†è¾¨ç‡æœ€é«˜ã€‚é‚£ä¹ˆæˆ‘ä»¬åªè¦æƒ³åŠæ³•æŠŠåŸå›¾æŒ‰ä¸åŒlevelç¼©æ”¾åˆ‡å‰²å°±è¡Œã€‚level1å°±æ˜¯ç›´æ¥å®½é«˜å„ç¼©æ”¾4å€ï¼Œlevel2å„ç¼©æ”¾2å€ï¼Œå†æŠŠå®ƒåˆ‡æˆ4å¼ ï¼Œæ¯å¼ å¤§å°ä¸º512*512ï¼Œlevel3çš„æ—¶å€™ä¸ç”¨ç¼©æ”¾ï¼Œç›´æ¥åˆ‡æˆ16å¼ ï¼ŒåŒæ ·æ¯å¼ 512*512.æˆ‘ä»¬æŠŠ\r\nä¸åŒlevelçš„å›¾ç‰‡æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶å¤¹ä¸‹ï¼Œç„¶åç”¨èƒ½å¤ŸåŠ è½½ç“¦ç‰‡åœ°å›¾çš„åº“å°±èƒ½åŠ è½½ï¼Œä¾‹å¦‚openlayersã€‚æ‰€ä»¥æˆ‘ä»¬å‰©ä¸‹çš„é—®é¢˜å°±æ˜¯æ€ä¹ˆåˆ‡å›¾äº†ã€‚\r\n```javascript\r\nimport 'ol/ol.css';\r\nimport Map from 'ol/Map';\r\nimport TileLayer from 'ol/layer/Tile';\r\nimport View from 'ol/View';\r\nimport XYZ from 'ol/source/XYZ';\r\n\r\nvar map = new Map({\r\n  target: 'map',\r\n  layers: [\r\n    new TileLayer({\r\n      source: new XYZ({\r\n        url:\r\n          'https://localhost:9080/tiles/{z}-{x}-{y}.png'    //å› ä¸ºæˆ‘çš„å›¾ç‰‡æ˜¯ 1-1-1è¿™ç§å½¢å¼ç»„æˆæ‰€ä»¥è¿™é‡Œæ˜¯è¿™æ ·ï¼Œå¦‚æœä½ çš„å›¾ç‰‡æ˜¯æŒ‰ç­‰çº§æ”¾åœ¨ä¸åŒæ–‡ä»¶å¤¹è¦å†™æˆ https://localhost:9080/tiles/{z}/{x}/{y}.png å…·ä½“æ€ä¹ˆæ”¾è¦çœ‹ä½ å¦‚ä½•ç»„ç»‡çš„tilesç»“æ„\r\n      }),\r\n    }) ],\r\n  view: new View({\r\n    center: [-472202, 7530279],\r\n    zoom: 12,\r\n  }),\r\n});\r\n```\r\n\r\n<img width=\"967\" alt=\"QQ20210615-225842@2x\" src=\"https://user-images.githubusercontent.com/18588945/122076316-5af83c00-ce2d-11eb-9f5e-b144e416ee1f.png\">\r\n\r\n# ä½¿ç”¨imagemagicå¤„ç†å›¾ç‰‡\r\n> Use ImageMagickÂ® to create, edit, compose, or convert digital images. It can read and write images in a variety of formats (over 200) including PNG, JPEG, GIF, WebP, HEIC, SVG, PDF, DPX, EXR and TIFF. ImageMagick can resize, flip, mirror, rotate, distort, shear and transform images, adjust image colors, apply various special effects, or draw text, lines, polygons, ellipses and BÃ©zier curves.\r\n\r\n[imagemagic](https://imagemagick.org/index.php)æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å›¾ç‰‡å¤„ç†å·¥å…·ï¼Œå¯ä»¥ç”¨å‘½ä»¤è¡Œç›´æ¥å¤„ç†å›¾ç‰‡ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°å„ç§å›¾ç‰‡å¤„ç†æ“ä½œã€‚è™½ç„¶å¾ˆå¼ºå¤§ä½†ä¸å¾—ä¸è¯´æ–‡æ¡£å¾ˆæ™¦æ¶©éš¾æ‡‚ï¼Œæˆ‘ä¹Ÿåªæ˜¯ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ç†Ÿæ‚‰äº†å‡ ä¸ªå‘½ä»¤è€Œå·²ï¼Œå®Œå…¨è°ˆä¸ä¸Šç²¾é€šã€‚\r\n[æˆ‘ä»¬çš„åˆ‡å›¾å·¥å…·åˆ†2ä¸ªæ­¥éª¤ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯æŒ‰ä¸åŒlevelåˆ‡å›¾ï¼Œä½†æ˜¯å› ä¸ºå¹¶ä¸æ˜¯åˆšå¥½å¦‚åŸç†åˆ†æé‡Œè®²çš„é‚£ä¹ˆåˆšå¥½å°±æ˜¯æ•´æ•°å€ï¼Œåœ°å›¾åŸå›¾å¾€å¾€ä¸æ˜¯åˆšå¥½æ˜¯æ­£æ–¹å½¢ï¼Œæ¯”å¦‚åˆ‡çš„ç“¦ç‰‡æ¯ä¸ªä¸º512*512ï¼Œåˆ‡åˆ°è¾¹ä¸Šçš„æ—¶å€™å¯èƒ½åªæœ‰360*400è¿™æ ·çš„ï¼Œè¿™æ—¶éœ€è¦æŠŠå®ƒè¡¥æˆ512*512ï¼Œä¸ç„¶ä¼šæœ‰å¥‡æ€ªçš„ç°è±¡å‘ç”Ÿã€‚æ³¨æ„ï¼Œè„šæœ¬é‡Œæœ‰äº›å‚æ•°è¦æ ¹æ®ä½ çš„å®é™…æƒ…å†µè‡ªå·±è®¾ç½®ã€‚[æºç åœ°å€](https://github.com/gwl002/imagemagicScript)\r\n```bash\r\n#! /bin/bash\r\n#cropFile.sh\r\nINDEX=1\r\nIMAGE_WIDTH=10752   #åŸå›¾å®½åº¦\r\nIMAGE_HEIGHT=21504  #åŸå›¾é«˜åº¦\r\n\r\nfor file in `ls \"originImages\"`;do #å°†åŸå›¾æ”¾åœ¨orginalImagesæ–‡ä»¶å¤¹ä¸‹\r\n\techo \"processing ${file}\"\r\n\tfile_base=$(basename $file .png) #æ‹¿åˆ°åŸå›¾åç§°\r\n\ttiles_dir=\"${file_base}_tiles\"   #ç¢°åˆ°æœ‰æ— ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œæœ‰åˆ™ç›´æ¥ä¸‹ä¸€æ­¥ï¼Œæ²¡æœ‰å°±å»ºç«‹æ–‡ä»¶å¤¹\r\n\tif [ -e \"${tiles_dir}\" ] && [ -d \"${tiles_dir}\" ];then \r\n\t\techo \"${tiles_dir} exisit\"\r\n\telse\r\n\t\techo \"mkdir ${tiles_dir}\"\r\n\t\tmkdir \"${tiles_dir}\"\r\n\t\techo \"mkdir ${tiles_dir} completed\"\r\n\tfi\r\n\tfor (( i=1; i<=7; i++));do    #æ ¹æ®ä½ è‡ªå·±çš„éœ€æ±‚è°ƒèŠ‚æ‰€éœ€çš„ç­‰çº§\r\n\t\techo \"processing ${file} scale ${i}\"\r\n\t\t((level= 7 - i))\r\n\t\t((scale= 2 ** (i-1)))\r\n\t\t((width= $IMAGE_WIDTH / $scale))\r\n\t\t((height= $IMAGE_HEIGHT / $scale))\r\n\t\tresizeFormat=\"${width}x${height}\"\r\n\t\techo $resizeFormat\r\n\t\tconvert \"originImages/${file}\" -resize $resizeFormat -crop 512x512 -set filename:tile ./${tiles_dir}/${level}-%[fx:page.x/512]-%[fx:page.y/512] %[filename:tile].png\r\n\t\techo \"complete ${file} scale ${i}\"\r\n\tdone\r\n\techo \"complete ${file}\"\r\n\tlet INDEX=${INDEX}+1\r\ndone\r\n```\r\n```bash\r\n#! /bin/bash\r\n#fillSize.sh\r\nSTART=`date +%s%N`;\r\nfor folder in `ls | grep \"H*tiles\"`;do  #æ‰¾åˆ°æ‰€æœ‰ä¹‹å‰åˆ‡ç‰‡ç”Ÿæˆçš„æ–‡ä»¶å¤¹ï¼Œéå†å…¶ä¸­æ‰¾åˆ°å…¶ä¸­å°ºå¯¸ä¸å¯¹çš„ï¼Œå°†å…¶æ”¾ç½®åœ¨512*512é€æ˜å›¾çš„å·¦ä¸Šè§’\r\n\techo $folder\r\n\tfor image in `ls $folder`;do\r\n\t\techo $image\r\n\t\tratio=`identify \"${folder}/${image}\" | cut -d \" \" -f 3`\r\n\t\tif [ \"$ratio\" != \"128x128\" ];then\r\n\t\t\techo $ratio\r\n\t\t\tconvert \"${folder}/${image}\" -background transparent -gravity NorthWest -extent 512x512 \"${folder}/${image}\"\r\n\t\tfi \r\n\tdone\r\ndone\r\nEND=`date +%s%N`;\r\ntime=$((END-START))\r\ntime=`expr $time / 1000000`\r\necho \"totally spend time ${time}\"\r\n```\r\n\r\n","url":"https://github.com/gwl002/gwl002.github.io/issues/5","createdAt":"2021-06-15T15:45:09Z","tags":["å·¥ä½œç»éªŒ"]},{"title":"next-blog","body":"---\r\ndescription: ç®€å•æµ‹è¯•front-matter\r\nkeywords: 11\r\n---\r\næµ‹è¯•å†™ä¸€ä¸ªnext-blog","url":"https://github.com/gwl002/gwl002.github.io/issues/4","createdAt":"2021-06-11T02:42:50Z","tags":["react"]},{"title":"rxjså®ç°è´ªåƒè›‡å°æ¸¸æˆ","body":"æœ¬æ–‡ä»‹ç»åŸºäºrxjså†™ä¸€ä¸ªç»å…¸çš„æ¸¸æˆè´ªåƒè›‡çš„è¿‡ç¨‹ã€‚","url":"https://github.com/gwl002/gwl002.github.io/issues/3","createdAt":"2021-06-10T16:15:20Z","tags":["react"]},{"title":"ä½¿ç”¨javascriptç”Ÿæˆpdfæ–‡ä»¶","body":"ä¸€ä¸ªæ•™è‚²ç½‘ç«™é¡¹ç›®æœ‰ä¸ªéœ€æ±‚ï¼Œéœ€è¦åœ¨å­¦å‘˜å®ŒæˆæŸäº›æµ‹è¯•åç”Ÿæˆè¯ä¹¦å¹¶ä¸‹è½½ã€‚æœ¬ä»¥ä¸ºåº”è¯¥æ˜¯è°ƒç”¨åç«¯çš„æ¥å£ç”Ÿæˆï¼Œä½†æ˜¯åç«¯ä¹Ÿè¯´ä¸å¤ªæ‡‚ï¼Œåªå¥½å‰ç«¯æ¥ç ”ç©¶ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚googleä¸€ä¸‹åå‘ç°æ¯”è¾ƒé è°±çš„æœ‰2ç§æ–¹æ¡ˆã€‚\r\n\r\n- ä½¿ç”¨jspdfå’Œhtml2canvasè¿™2ä¸ªåº“åœ¨å‰ç«¯å®ç°\r\n- ä½¿ç”¨nodejsé€šè¿‡puppeteer åœ¨åç«¯ç”Ÿæˆ\r\n\r\nä¸‹é¢åˆ†åˆ«è¯´è¯´è¿™2ç§æ–¹æ³•çš„å®ç°ã€‚\r\n\r\n# ä½¿ç”¨jspdfç”Ÿæˆpdf\r\n\r\n\r\né¦–å…ˆç¼–å†™pdfæ¨¡ç‰ˆçš„html(æˆ‘è¿™é‡Œæ˜¯ç”¨reactå†™çš„)ã€‚\r\n```jsx\r\n<Cert\r\n    chineseName={chineseName}\r\n    englishName={englishName}\r\n    unitInfo={unitInfo}\r\n/>\r\n```\r\nå› ä¸ºè¿™ä¸ªæ¨¡ç‰ˆåªæ˜¯ç”¨æ¥ç”Ÿæˆpdfï¼Œå¹¶ä¸ç”¨æ˜¾ç¤ºï¼Œæ‰€ä»¥é€šè¿‡csså°†å…¶æ”¾åœ¨è§†é‡ä¹‹å¤–ã€‚\r\n```css\r\n.cert {\r\n    width: 870px;\r\n    height: 615px;\r\n    position: absolute;\r\n    // background:transparent url($imgData) ;\r\n    // background-size: 100%;\r\n    // top:-30px;\r\n    left: 5000px;\r\n    visibility: hidden;\r\n    z-index: 99;\r\n}\r\n```\r\næ ¸å¿ƒä»£ç ,å…ˆç”¨html2canvaså°†htmlè½¬æˆcanvasï¼Œå†å°†canvasè½¬æˆimage dataurlï¼Œå†å°†imageå†™å…¥pdfä¸­ã€‚\r\n```jsx\r\nconst savePDF = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n        const jsPDF = (await import(\"jspdf\")).default; //å¼•å…¥jspdf\r\n        const html2canvas = (await import(\"html2canvas\")).default; //å¼•å…¥html2canvas\r\n        let canvas = await html2canvas(document.querySelector(\"#cert\"), {\r\n            scrollY: 0,  //ä¸è®¾ç½®æ­¤å±æ€§ æ»šåŠ¨è§†å›¾æ—¶ä¼šå¯¼è‡´ä¸‹è½½çš„pdfæœ‰éƒ¨åˆ†ä¸æ˜¾ç¤º\r\n            onclone: (clonedDoc) => {\r\n                clonedDoc.getElementById(\"cert\").style.visibility = 'visible'; //å°†pdfæ¨¡ç‰ˆè®¾ä¸ºå¯è§\r\n            }\r\n        })\r\n        var imgData = canvas.toDataURL('image/png');\r\n        var doc = new jsPDF('l', 'mm', \"a4\", true); \r\n        var width = doc.internal.pageSize.getWidth();\r\n        var height = doc.internal.pageSize.getHeight();\r\n        doc.addImage(imgData, 'PNG', 0, 0, width, height, \"\", \"FAST\"); //FAST æ˜¯å¦å‹ç¼©\r\n        // let pdf = doc.output('blob');\r\n        // let form = new FormData();\r\n        doc.output('save', 'Certificate.pdf');\r\n    } catch (err) {\r\n        console.log(err);\r\n    } finally {\r\n        setIsLoading(false)\r\n    }\r\n}\r\n```\r\nè¿™å°±å¤§åŠŸå‘Šæˆäº†ï¼Ÿé«˜å…´çš„å¤ªæ—©ï¼ğŸ˜­ğŸ˜­ğŸ˜­é—®é¢˜æ€»æ˜¯å±‚å‡ºä¸ç©·çš„å¤šã€‚åœ¨ç”¨æ­¤æ–¹æ³•ä¸­ä¸€å…±é‡åˆ°ä¸‰ä¸ªè¾ƒå¤§çš„é—®é¢˜ã€‚\r\n\r\n1. åˆæ­¥å®ç°åŠŸèƒ½æäº¤åï¼Œä¸€å¤©qaçªç„¶å’Œæˆ‘è¯´æ€ä¹ˆç”Ÿæˆçš„pdfä¸ŠåŠéƒ¨åˆ†æ˜¯ç©ºç™½çš„ã€‚æ²¡åŠæ³•ï¼Œæ‰¾æ‰¾æ‰¾ã€‚é€šè¿‡googleï¼Œå‘ç°æ˜¯html2canvasæ—¶ä¼šæ ¹æ®ç”¨æˆ·æ»šåŠ¨çš„ä½ç½®æ¥è®¡ç®—çš„ï¼Œè®¾ç½®scrollY: 0è§£å†³ã€‚\r\n2. ä¹‹å‰åœ¨devåœºä¸­æµ‹è¯•å¹¶æ²¡æœ‰å‘ç°é—®é¢˜ï¼Œä½†æ˜¯ä¸Šäº†uatåå‘ç°pdfä¸­å›¾ç‰‡æ²¡åŠ è½½ã€‚æœ€åå‘ç°æ˜¯å› ä¸ºuatåœºå›¾ç‰‡å…¨éƒ¨æ”¾åœ¨äº†cdnçš„ç¼˜æ•…ï¼Œpdfä¸ä¼šåŠ è½½éåŒæºç«™çš„å›¾ç‰‡ä¹Ÿå°±è·¨åŸŸï¼Œè®¾ç½®useCORSä¹Ÿæ²¡æœ‰ç”¨ã€‚æœ€åç›´æ¥æŠŠpdfä¸­ç”¨åˆ°çš„å›¾ç‰‡æ¢æˆbase64è§£å†³ã€‚\r\n3. ä¸åŒçš„æµè§ˆå™¨å’Œè®¾å¤‡ç”Ÿæˆçš„pdfæ–‡ä»¶sizeä¸åŒã€‚æœ‰çš„åªæœ‰å‡ M,æœ‰çš„åå‡ Mã€‚è¿™ä¸ªåº”è¯¥å’Œè®¾å¤‡çš„åˆ†è¾¨ç‡æœ‰å…³ã€‚è®¾ç½®äº†æ˜¯å¦å‹ç¼©ï¼Œå¯ä»¥è°ƒèŠ‚pdfçš„sizeï¼Œä½†æ˜¯è¿˜æ˜¯æ— æ³•ç»Ÿä¸€ç”Ÿæˆçš„pdfçš„sizeã€‚\r\n\r\n# ä½¿ç”¨puppeteeråç«¯ç”Ÿæˆpdf \r\n\r\nåšè¿‡çˆ¬è™«çš„åº”è¯¥éƒ½å¬è¿‡é¼é¼å¤§åçš„phantomjsï¼Œå½“å¹´è¿™ä¸ªåº“å¾ˆç«ï¼Œå¯ä»¥è¯´æ˜¯ä¸€äº›æ¯”è¾ƒå¤æ‚ç½‘ç«™çš„çˆ¬è™«æœ€ç»ˆè§£å†³æ–¹æ¡ˆã€‚å› ä¸ºå®ƒå¯ä»¥è®©ä½ ç”¨jsæ“ä½œä¸€ä¸ªçœŸæ­£çš„æµè§ˆå™¨å»è®¿é—®ç½‘ç«™ã€‚puppeteeræ˜¯googleæ¨å‡ºçš„headless chromeï¼Œå¯ä»¥è¯´æ˜¯phantomjsçš„æ›¿ä»£å“ï¼Œè‡ªä»è¿™ä¸ªåº“å‡ºä¸–ï¼Œphantomjså¥½åƒå°±åœæ­¢ç»´æŠ¤äº†ã€‚\r\n\r\n>  Puppeteer is a Node library which provides a high-level API to control Chrome or Chromium over the DevTools Protocol. Puppeteer runs headless by default, but can be configured to run full (non-headless) Chrome or Chromium.\r\n\r\nä¸ºäº†è§£å†³ä¸Šé¢è¯´çš„ä¸åŒè®¾å¤‡ç”Ÿæˆçš„pdf sizeä¸åŒçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨puppeteeræ¥åœ¨åç«¯ç”Ÿæˆpdfã€‚\r\nå› ä¸ºç”Ÿæˆçš„è¯ä¹¦å¦‚å§“åæˆç»©ä¹‹ç±»çš„æ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥è¦ç”¨æ¨¡ç‰ˆåŠ¨æ€ç”Ÿæˆï¼Œå› ä¸ºæˆ‘çš„é¡¹ç›®æ˜¯reactï¼Œæ‰€ä»¥ç›´æ¥ç”¨jsxç”Ÿæˆæ¨¡æ¿ï¼Œç”¨rendertostringç”Ÿæˆhtmlå­—ç¬¦ä¸²ã€‚ä¹Ÿæœ‰ä¸€äº›styleå’Œå›¾ç‰‡å¤„ç†æ¯”è¾ƒéº»çƒ¦ï¼Œå¯ä»¥çœ‹æˆ‘ä»£ç ï¼Œä½†æ˜¯è¿™é‡Œåªæ˜¯ç®€å•å®ç°ã€‚\r\n\r\n```jsx\r\nconst PdfTemplate = ({ imgSrc }) => {\r\n    return (\r\n        <div className=\"bg\">\r\n            <h2>heading</h2>\r\n            <div>\r\n                content\r\n            </div>\r\n            <img src={imgSrc} alt=\"\" style={{ width: \"100%\", height: 300 }} />\r\n        </div>\r\n    )\r\n}\r\n\r\nconst createHtmlStr = () => {\r\n    const imagePath = __dirname + \"/../../../../public/images/bg.jpeg\";\r\n    const imgData = fs.readFileSync(imagePath).toString(\"base64\");\r\n    const imgSrc = `data:image/jpeg;base64,${imgData}`;\r\n    const content = ReactDOMServer.renderToString(<PdfTemplate imgSrc={imgSrc} />)\r\n    return `\r\n        <html>\r\n            <head>\r\n                <style>\r\n                    html,body{\r\n                        margin:0;\r\n                        padding:0;\r\n                        height:100%\r\n                    }\r\n                    .bg{\r\n                        height:100%;\r\n                        position:relative;\r\n                    }\r\n                </style>\r\n            </head>\r\n            <body>\r\n                ${content}\r\n            </body>\r\n        </html>\r\n    `\r\n}\r\n```\r\nåç«¯ä»£ç \r\n```javascript\r\nexport default async function handler(req, res) {\r\n    console.log(\"start\")\r\n    const browser = await puppeteer.launch({\r\n        args: ['--disable-dev-shm-usage', '--no-sandbox']\r\n    });\r\n    const page = await browser.newPage();\r\n    ;\r\n    const html = createHtmlStr();\r\n    console.log(html, \"====\")\r\n    // await page.goto(\"http://localhost:3000/\");\r\n    await page.setContent(html);\r\n    const pdf = await page.pdf({\r\n        format: 'A4',\r\n        printBackground: true,\r\n        '-webkit-print-color-adjust': 'exact',\r\n    });\r\n    await browser.close();\r\n    console.log(\"end render\");\r\n    res.setHeader(\"Content-Type\", 'application/pdf');\r\n    res.status(200);\r\n    res.send(pdf);\r\n}\r\n\r\n```\r\nå‰ç«¯ä»£ç \r\n```javascript\r\n  const downloadPDF = async () => {\r\n          let response = await fetch(\"/api/createPdf\", {\r\n              responseType: 'arraybuffer',\r\n              headers: {\r\n                  'Accept': 'application/pdf'\r\n              }\r\n          });\r\n          let blob = await response.blob();\r\n          // const blob = new Blob([response.body], { type: 'application/pdf' })\r\n          const link = document.createElement('a')\r\n          link.href = window.URL.createObjectURL(blob)\r\n          link.download = `your-file-name.pdf`\r\n          link.click()\r\n  }\r\n```\r\n# æ€»ç»“\r\n\r\n1. åœ¨å‰ç«¯é€šè¿‡æˆªå±htmlå…ƒç´ ç”Ÿæˆpdfï¼Œç®€å•æ–¹ä¾¿ï¼Œä¸éœ€è¦åç«¯é…åˆï¼Œç›´æ¥åœ¨å‰ç«¯ç”Ÿæˆpdfï¼Œç¼ºç‚¹å°±æ˜¯ç”Ÿæˆçš„pdfæ–‡ä»¶å¤§å°ä¸ç»Ÿä¸€ã€‚\r\n2. åœ¨åç«¯ç”¨puppeteerç”Ÿæˆpdfï¼Œå¯ä»¥è§£å†³ä¸Šè¿°æ–¹æ³•çš„é—®é¢˜ï¼Œä½†æ˜¯è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æ¥å£ï¼Œéœ€è¦åŠ ä¸€ä¸ªnodeæœåŠ¡ï¼Œè¿™ä¸ªé¡¹ç›®å› ä¸ºæˆ‘ä»¬æ˜¯ç”¨nextjså†™çš„ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆæ–¹ä¾¿çš„åŠ ä¸€ä¸ªapiæ¥å£ã€‚ä½†æ˜¯ä¸€èˆ¬æˆ‘ä»¬çš„åç«¯éƒ½æ˜¯javaå†™çš„ï¼Œè¦é¢å¤–çš„å¼€ä¸€ä¸ªnodeæœåŠ¡ä¸æ˜¯ç‰¹åˆ«æ–¹ä¾¿ã€‚\r\n\r\n","url":"https://github.com/gwl002/gwl002.github.io/issues/2","createdAt":"2021-06-06T14:54:27Z","tags":["å·¥ä½œç»éªŒ"]}],"tags":[{"name":"javascript","color":"1d76db"},{"name":"react","color":"8E26BB"},{"name":"css","color":"F49416"},{"name":"å·¥ä½œç»éªŒ","color":"bfdadc"}],"title":"æš®å¤©äº‘å…‰","subTitle":"å·¥ä½œç»éªŒã€å­¦ä¹ ç¬”è®°ã€å…´è¶£çˆ±å¥½"},"__N_SSG":true}